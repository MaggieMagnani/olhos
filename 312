-- =============================================
-- UM ÚNICO OLHO GRANDE - MOVIMENTO ENTRE TELAS
-- =============================================

print("=== INICIANDO OLHO ÚNICO ===")

-- Pega TODAS as telas
local telas = {peripheral.find("monitor")}
if not telas[1] then telas = {telas} end

print("Telas detectadas: " .. #telas)

-- Configura todas as telas
for i, tela in ipairs(telas) do
    tela.setTextScale(0.5)
    tela.setBackgroundColor(colors.black)
    tela.clear()
end

-- Sistema do Olho ÚNICO
local tempo = 0

-- Organizar telas em posições fixas (uma do lado da outra)
function organizarTelas()
    print("Organizando " .. #telas .. " telas...")
    
    local larguraTela, alturaTela = 8, 5
    local x, y = 1, 1
    
    for i, tela in ipairs(telas) do
        tela.posX = x
        tela.posY = y
        tela.largura = larguraTela
        tela.altura = alturaTela
        tela.numero = i
        
        x = x + larguraTela + 1
        
        -- Quebra linha a cada 6 telas
        if i % 6 == 0 then
            x = 1
            y = y + alturaTela + 1
        end
    end
end

-- Limpar TODAS as telas
function limparTodasTelas()
    for i, tela in ipairs(telas) do
        tela.setBackgroundColor(colors.black)
        tela.clear()
    end
end

-- Desenhar UM ÚNICO olho grande em uma tela específica
function desenharOlhoUnico(telaAlvo, posX, posY)
    -- Limpar todas as telas primeiro
    limparTodasTelas()
    
    -- Desenhar apenas na tela alvo
    local tela = telas[telaAlvo]
    
    -- Olho GRANDE (6x4 pixels)
    -- Branco do olho
    for x = posX - 2, posX + 3 do
        for y = posY - 1, posY + 2 do
            if x >= 1 and x <= tela.largura and y >= 1 and y <= tela.altura then
                tela.setBackgroundColor(colors.white)
                tela.setCursorPos(x, y)
                tela.write(" ")
            end
        end
    end
    
    -- Íris azul (4x2 pixels)
    for x = posX - 1, posX + 2 do
        for y = posY, posY + 1 do
            if x >= 1 and x <= tela.largura and y >= 1 and y <= tela.altura then
                tela.setBackgroundColor(colors.blue)
                tela.setCursorPos(x, y)
                tela.write(" ")
            end
        end
    end
    
    -- Pupila preta (2x1 pixels)
    for x = posX, posX + 1 do
        if x >= 1 and x <= tela.largura and posY >= 1 and posY <= tela.altura then
            tela.setBackgroundColor(colors.black)
            tela.setCursorPos(x, posY)
            tela.write(" ")
        end
    end
    
    -- Brilho
    if posX >= 1 and posX <= tela.largura and posY - 1 >= 1 and posY - 1 <= tela.altura then
        tela.setBackgroundColor(colors.lightBlue)
        tela.setCursorPos(posX, posY - 1)
        tela.write(" ")
    end
end

-- Movimento: visita cada tela uma por uma
function movimentoVisitaTelas(t)
    -- Tempo para ficar em cada tela (em segundos)
    local tempoPorTela = 3.0
    local telaAtual = (math.floor(t / tempoPorTela) % #telas) + 1
    
    -- Posição central na tela
    local posX = math.floor(telas[telaAtual].largura / 2)
    local posY = math.floor(telas[telaAtual].altura / 2)
    
    return telaAtual, posX, posY
end

-- Movimento: caminho contínuo entre telas
function movimentoCaminhoContinuo(t)
    -- Velocidade do movimento
    local velocidade = 0.3
    
    -- Definir um caminho fixo entre as telas
    local caminho = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36}
    
    -- Calcular tela atual baseada no tempo
    local progresso = (t * velocidade) % #caminho
    local telaIndex = math.floor(progresso) + 1
    local telaAtual = caminho[telaIndex]
    
    if telaAtual > #telas then
        telaAtual = 1
    end
    
    -- Movimento suave dentro da tela
    local subProgresso = progresso - math.floor(progresso)
    local posX, posY
    
    if subProgresso < 0.25 then
        -- Canto superior esquerdo
        posX = 2
        posY = 2
    elseif subProgresso < 0.5 then
        -- Canto superior direito
        posX = telas[telaAtual].largura - 1
        posY = 2
    elseif subProgresso < 0.75 then
        -- Canto inferior direito
        posX = telas[telaAtual].largura - 1
        posY = telas[telaAtual].altura - 1
    else
        -- Canto inferior esquerdo
        posX = 2
        posY = telas[telaAtual].altura - 1
    end
    
    return telaAtual, posX, posY
end

-- Movimento: aleatório suave entre telas
function movimentoAleatorioSuave(t)
    -- Mudar de tela a cada 2 segundos
    local tempoPorTela = 2.0
    local telaAtual = (math.floor(t / tempoPorTela) % #telas) + 1
    
    -- Posição aleatória mas dentro dos limites
    local posX = math.random(3, telas[telaAtual].largura - 2)
    local posY = math.random(2, telas[telaAtual].altura - 2)
    
    return telaAtual, posX, posY
end

-- Movimento: em espiral pelas telas
function movimentoEspiralTelas(t)
    -- Organizar telas em espiral
    local centro = math.ceil(#telas / 2)
    local telaAtual = (math.floor(t * 0.5) % #telas) + 1
    
    -- Posição central
    local posX = math.floor(telas[telaAtual].largura / 2)
    local posY = math.floor(telas[telaAtual].altura / 2)
    
    return telaAtual, posX, posY
end

-- Animação principal
function executarAnimacao()
    local modosMovimento = {
        movimentoVisitaTelas,
        movimentoCaminhoContinuo,
        movimentoAleatorioSuave,
        movimentoEspiralTelas
    }
    
    local nomesModos = {
        "Visita Ordenada",
        "Caminho Contínuo",
        "Aleatório Suave",
        "Espiral"
    }
    
    local modoAtual = 1
    local ultimaTroca = os.time()
    
    print("\n=== OLHO ÚNICO ATIVADO ===")
    print("Modo: " .. nomesModos[modoAtual])
    print("Pressione Ctrl+T para parar")
    print("===========================\n")
    
    while true do
        -- Trocar modo a cada 40 segundos
        if os.time() - ultimaTroca > 40 then
            modoAtual = (modoAtual % #modosMovimento) + 1
            ultimaTroca = os.time()
            print("Mudando para modo: " .. nomesModos[modoAtual])
        end
        
        -- Calcular posição do olho
        local telaAlvo, posX, posY = modosMovimento[modoAtual](tempo)
        
        -- Desenhar o ÚNICO olho na tela alvo
        desenharOlhoUnico(telaAlvo, posX, posY)
        
        -- Mostrar info no console
        if math.floor(tempo * 10) % 50 == 0 then
            print("Olho na tela " .. telaAlvo .. " - Posição: " .. posX .. "," .. posY)
        end
        
        tempo = tempo + 0.1
        os.sleep(0.2)
    end
end

-- Mostrar informações
function mostrarInfo()
    print("\n=== SISTEMA OLHO ÚNICO ===")
    print("Telas: " .. #telas)
    print("Características:")
    print("- UM ÚNICO olho grande")
    print("- Movimento entre telas")
    print("- 4 modos de movimento")
    print("- Olho ocupa tela inteira")
    print("========================")
end

-- Programa principal
if #telas == 0 then
    print("ERRO: Nenhuma tela detectada!")
else
    math.randomseed(os.time())
    organizarTelas()
    mostrarInfo()
    executarAnimacao()
end
