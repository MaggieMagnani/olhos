-- =============================================
-- SHOW BALADA PERFEITO - VERSÃO DEFINITIVA
-- =============================================

print("=== SHOW BALADA PERFEITO ===")

-- Configuração dos monitores
local monitores = {peripheral.find("monitor")}
if not monitores[1] then monitores = {monitores} end
if #monitores == 0 then print("ERRO: Nenhum monitor!"); return end

print("Monitores: " .. #monitores)

for i, mon in ipairs(monitores) do
    mon.setTextScale(0.5)
end

-- Tamanho da tela gigante
local larguras = {}
local larguraTotal, alturaTotal = 0, 0

for i, mon in ipairs(monitores) do
    local w, h = mon.getSize()
    larguras[i] = w
    larguraTotal = larguraTotal + w
    alturaTotal = math.max(alturaTotal, h)
end

print("Tela gigante: " .. larguraTotal .. "x" .. alturaTotal)

-- Paleta de cores vibrantes
local cores = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white,
    colors.brown, colors.lightGray
}

-- Função de desenho otimizada
function desenhar(x, y, cor)
    local xAtual = 0
    for i, mon in ipairs(monitores) do
        local w = larguras[i]
        if x >= xAtual and x < xAtual + w and y >= 1 and y <= alturaTotal then
            mon.setBackgroundColor(cor)
            mon.setCursorPos(x - xAtual + 1, y)
            mon.write(" ")
            return
        end
        xAtual = xAtual + w
    end
end

-- 1. LASERS ESPETACULAR (totalmente refeito)
function lasers()
    print("Lasers Espetacular Ativado")
    
    local lasers = {}
    for i = 1, 8 do
        lasers[i] = {
            angulo = math.random(0, 360),
            velocidade = math.random(8, 15),
            cor = cores[i % #cores + 1],
            tamanho = math.random(30, 50)
        }
    end
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Desenhar lasers
        for i, laser in ipairs(lasers) do
            laser.angulo = (laser.angulo + laser.velocidade) % 360
            
            local centroX = math.floor(larguraTotal / 2)
            local centroY = math.floor(alturaTotal / 2)
            
            for t = 0, laser.tamanho, 0.7 do
                local x = centroX + math.cos(math.rad(laser.angulo)) * t
                local y = centroY + math.sin(math.rad(laser.angulo)) * t
                
                x = math.floor(x)
                y = math.floor(y)
                
                if x >= 1 and x <= larguraTotal and y >= 1 and y <= alturaTotal then
                    desenhar(x, y, laser.cor)
                    -- Efeito de brilho
                    if math.random(1, 3) == 1 then
                        desenhar(x + 1, y, laser.cor)
                        desenhar(x - 1, y, laser.cor)
                    end
                end
            end
        end
        
        os.sleep(0.08)
    end
end

-- 2. FOGOS ESPETACULARES (muito melhorado)
function fogos()
    print("Fogos Espetaculares Ativado")
    
    local fogos = {}
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Novo fogo
        if math.random(1, 6) == 1 and #fogos < 8 then
            table.insert(fogos, {
                x = math.random(10, larguraTotal - 10),
                y = alturaTotal + 5,
                vel = math.random(4, 8),
                explosaoY = math.random(15, math.floor(alturaTotal * 0.3)),
                explodiu = false,
                particulas = {},
                cor = cores[math.random(1, #cores)]
            })
        end
        
        -- Atualizar fogos
        for i = #fogos, 1, -1 do
            local fogo = fogos[i]
            
            if not fogo.explodiu then
                -- Foguete subindo
                fogo.y = fogo.y - fogo.vel
                
                -- Rastro do foguete
                for r = 0, 3 do
                    local yRastro = fogo.y + r
                    if yRastro <= alturaTotal and yRastro >= 1 then
                        desenhar(fogo.x, yRastro, colors.white)
                        desenhar(fogo.x + 1, yRastro, colors.orange)
                        desenhar(fogo.x - 1, yRastro, colors.orange)
                    end
                end
                
                -- Explodir
                if fogo.y <= fogo.explosaoY then
                    fogo.explodiu = true
                    -- Criar explosão espetacular
                    for p = 1, 35 do
                        local angulo = math.random(0, 360)
                        local velocidade = math.random(2, 6) / 2
                        local vida = math.random(40, 80)
                        
                        fogo.particulas[p] = {
                            x = fogo.x,
                            y = fogo.y,
                            dx = math.cos(math.rad(angulo)) * velocidade,
                            dy = math.sin(math.rad(angulo)) * velocidade,
                            vida = vida,
                            cor = cores[math.random(1, #cores)],
                            tamanho = math.random(1, 3)
                        }
                    end
                end
            else
                -- Explosão
                local todasMortas = true
                
                for p, particula in ipairs(fogo.particulas) do
                    if particula.vida > 0 then
                        todasMortas = false
                        
                        -- Mover partícula
                        particula.x = particula.x + particula.dx
                        particula.y = particula.y + particula.dy
                        particula.vida = particula.vida - 1
                        
                        -- Desenhar partícula
                        if particula.x >= 1 and particula.x <= larguraTotal and 
                           particula.y >= 1 and particula.y <= alturaTotal then
                           
                            desenhar(math.floor(particula.x), math.floor(particula.y), particula.cor)
                            
                            -- Partículas maiores
                            if particula.tamanho > 1 then
                                desenhar(math.floor(particula.x) + 1, math.floor(particula.y), particula.cor)
                                desenhar(math.floor(particula.x) - 1, math.floor(particula.y), particula.cor)
                            end
                            if particula.tamanho > 2 then
                                desenhar(math.floor(particula.x), math.floor(particula.y) + 1, particula.cor)
                                desenhar(math.floor(particula.x), math.floor(particula.y) - 1, particula.cor)
                            end
                        end
                    end
                end
                
                if todasMortas then
                    table.remove(fogos, i)
                end
            end
        end
        
        -- Estrelas de fundo
        for s = 1, math.floor(larguraTotal * 0.1) do
            local x = math.random(1, larguraTotal)
            local y = math.random(1, alturaTotal)
            if math.random(1, 3) == 1 then
                desenhar(x, y, colors.white)
            end
        end
        
        os.sleep(0.1)
    end
end

-- 3. TUNEL PERFEITO (totalmente refeito)
function tunel()
    print("Tunel Perfeito Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.2
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        local centroX = math.floor(larguraTotal / 2)
        local centroY = math.floor(alturaTotal / 2)
        local maxRaio = math.max(larguraTotal, alturaTotal) * 0.6
        
        -- Desenhar túnel
        for anel = 1, 15 do
            local progresso = anel / 15
            local raio = progresso * maxRaio + math.sin(tempo + anel * 0.3) * 3
            local cor = cores[(anel + math.floor(tempo)) % #cores + 1]
            
            -- Anel mais denso
            for angulo = 0, 360, 4 do
                local x = centroX + math.cos(math.rad(angulo)) * raio
                local y = centroY + math.sin(math.rad(angulo)) * raio
                
                x = math.floor(x)
                y = math.floor(y)
                
                if x >= 1 and x <= larguraTotal and y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                end
            end
        end
        
        -- Centro pulsante
        local centroRaio = 3 + math.sin(tempo * 3) * 2
        for y = -centroRaio, centroRaio do
            for x = -centroRaio, centroRaio do
                if x*x + y*y <= centroRaio*centroRaio then
                    local px = centroX + x
                    local py = centroY + y
                    if px >= 1 and px <= larguraTotal and py >= 1 and py <= alturaTotal then
                        desenhar(px, py, colors.white)
                    end
                end
            end
        end
        
        os.sleep(0.1)
    end
end

-- 4. PULSACOES ENERGETICAS (novo e funcionando)
function pulsacoes()
    print("Pulsacoes Energeticas Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.3
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Múltiplas pulsações
        for onda = 1, 5 do
            local cor = cores[(onda + math.floor(tempo)) % #cores + 1]
            local frequencia = 0.5 + onda * 0.1
            local amplitude = math.min(larguraTotal, alturaTotal) * 0.2
            
            local centroX = math.floor(larguraTotal / 2)
            local centroY = math.floor(alturaTotal / 2)
            
            local raio = (math.sin(tempo * frequencia) + 1) * amplitude
            
            -- Desenhar círculo pulsante
            for angulo = 0, 360, 3 do
                local x = centroX + math.cos(math.rad(angulo)) * raio
                local y = centroY + math.sin(math.rad(angulo)) * raio
                
                x = math.floor(x)
                y = math.floor(y)
                
                if x >= 1 and x <= larguraTotal and y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                end
            end
        end
        
        os.sleep(0.12)
    end
end

-- 5. CHUVA DE ENERGIAS (melhorado)
function chuva()
    print("Chuva de Energias Ativado")
    
    local particulas = {}
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Nova partícula
        if math.random(1, 2) == 1 then
            table.insert(particulas, {
                x = math.random(1, larguraTotal),
                y = 1,
                velocidade = math.random(3, 8),
                cor = cores[math.random(1, #cores)],
                tamanho = math.random(1, 4),
                oscilacao = math.random() * 2
            })
        end
        
        -- Atualizar partículas
        for i = #particulas, 1, -1 do
            local p = particulas[i]
            
            -- Mover com oscilação lateral
            p.x = p.x + math.sin(os.clock() + p.oscilacao) * 0.5
            p.y = p.y + p.velocidade
            
            -- Desenhar partícula com tamanho variado
            for dy = 0, p.tamanho - 1 do
                for dx = -math.floor(p.tamanho/2), math.floor(p.tamanho/2) do
                    local px = math.floor(p.x + dx)
                    local py = math.floor(p.y + dy)
                    
                    if px >= 1 and px <= larguraTotal and py >= 1 and py <= alturaTotal then
                        desenhar(px, py, p.cor)
                    end
                end
            end
            
            -- Rastro
            for r = 1, 3 do
                local yRastro = p.y - r * p.tamanho
                if yRastro >= 1 then
                    desenhar(math.floor(p.x), math.floor(yRastro), p.cor)
                end
            end
            
            -- Remover se saiu
            if p.y > alturaTotal + 10 then
                table.remove(particulas, i)
            end
        end
        
        os.sleep(0.1)
    end
end

-- 6. ONDAS ULTRA COLORIDAS (mais cores)
function ondas()
    print("Ondas Ultra Coloridas Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.15
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Muitas ondas coloridas
        for onda = 1, 8 do
            local cor = cores[(onda + math.floor(tempo * 2)) % #cores + 1]
            local frequencia = 0.08 + onda * 0.02
            local amplitude = alturaTotal * 0.1
            local offset = onda * 1.2
            
            for x = 1, larguraTotal do
                local y = math.sin(x * frequencia + tempo + offset) * amplitude + alturaTotal / 2
                y = math.floor(y)
                
                if y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                    -- Tornar a onda mais visível
                    if y > 1 then desenhar(x, y - 1, cor) end
                    if y < alturaTotal then desenhar(x, y + 1, cor) end
                    if math.random(1, 2) == 1 then
                        desenhar(x + 1, y, cor)
                        desenhar(x - 1, y, cor)
                    end
                end
            end
        end
        
        os.sleep(0.08)
    end
end

-- Menu simples
function menu()
    print("\n=================================")
    print("SHOW BALADA - " .. #monitores .. " TELAS")
    print("=================================")
    print("1. Lasers Espetacular")
    print("2. Fogos Espetaculares")
    print("3. Tunel Perfeito")
    print("4. Pulsacoes Energeticas")
    print("5. Chuva de Energias")
    print("6. Ondas Ultra Coloridas")
    print("=================================")
    
    write("Escolha (1-6): ")
    local e = read()
    
    if e == "1" then lasers()
    elseif e == "2" then fogos()
    elseif e == "3" then tunel()
    elseif e == "4" then pulsacoes()
    elseif e == "5" then chuva()
    elseif e == "6" then ondas()
    else print("Invalido!"); os.sleep(1) end
end

-- Iniciar
function main()
    while true do
        menu()
    end
end

main()
