-- =============================================
-- SHOW VISUAL MEGA MELHORADO - TELÃ•ES DO PALCO
-- =============================================

print("=== SHOW MEGA DOS TELÃ•ES ===")

-- Encontra os telÃµes
local teloes = {peripheral.find("monitor")}
if not teloes[1] then
    teloes = {teloes}
end

print("TelÃµes conectados: " .. #teloes)

-- Configura todos os telÃµes
for i, telao in ipairs(teloes) do
    telao.setTextScale(0.5)  -- Texto maior
end

-- PALETA MEGA COLORIDA - MUITO MAIS CORES!
local coresShow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white,
    colors.brown, colors.lightGray, colors.gray
}

-- =======================
-- EFEITOS MELHORADOS
-- =======================

-- 1. LASERS MEGA COLORIDOS (MELHORADO)
function efeitoLasersMega()
    print("ðŸ”¦ Efeito: SHOW DE LASERS MEGA")
    
    local angulos = {}
    local coresLasers = {}
    
    -- Inicializa com MUITAS cores
    for i = 1, #teloes do
        angulos[i] = math.random(1, 360)
        coresLasers[i] = {}
        for l = 1, 8 do  -- 8 lasers por telÃ£o!
            coresLasers[i][l] = coresShow[math.random(1, #coresShow)]
        end
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Atualiza Ã¢ngulo
            angulos[i] = (angulos[i] + math.random(8, 20)) % 360
            
            -- Desenha MUITOS feixes de laser
            local numLasers = 8  -- DOBRAMOS o nÃºmero de lasers!
            for laser = 1, numLasers do
                local angulo = angulos[i] + (laser * 360 / numLasers)
                local cor = coresLasers[i][laser]
                
                local centroX = math.floor(w / 2)
                local centroY = math.floor(h / 2)
                local raio = math.min(w, h) * 0.8
                
                -- Laser principal (mais grosso)
                for t = 0, raio, 0.3 do
                    local x = centroX + math.cos(math.rad(angulo)) * t
                    local y = centroY + math.sin(math.rad(angulo)) * t
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                        -- Efeito de brilho ao redor
                        if math.random(1, 3) == 1 then
                            telao.setCursorPos(x + 1, y)
                            telao.write(" ")
                            telao.setCursorPos(x - 1, y)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 2. TEXTO GIGANTE "BALADA" (MELHORADO)
function efeitoTextoGigante()
    print("ðŸŽª Efeito: TEXTO GIGANTE")
    
    local textos = {"BALADA", "FESTA", "SHOW", "DANCE", "DIVIRTA-SE", "FUN", "MUSIC", "VIBE"}
    local textoIndex = 1
    local frame = 0
    
    while true do
        frame = frame + 1
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Muda texto a cada 3 segundos
            if frame % 60 == 0 then
                textoIndex = (textoIndex % #textos) + 1
            end
            
            local texto = textos[textoIndex]
            local corFundo = coresShow[(frame + i - 1) % #coresShow + 1]
            local corTexto = colors.black
            
            -- TEXTO MAIOR: usa escala maior e posicionamento melhor
            telao.setTextScale(1)  -- TEXTO GIGANTE!
            
            -- Calcula posiÃ§Ã£o central
            local x = math.floor((w - #texto) / 2) + 1
            local y = math.floor(h / 2)
            
            -- Fundo colorido atrÃ¡s do texto
            for bgX = x - 1, x + #texto + 1 do
                for bgY = y - 1, y + 1 do
                    if bgX >= 1 and bgX <= w and bgY >= 1 and bgY <= h then
                        telao.setBackgroundColor(corFundo)
                        telao.setCursorPos(bgX, bgY)
                        telao.write(" ")
                    end
                end
            end
            
            -- Texto em destaque
            telao.setBackgroundColor(corFundo)
            telao.setTextColor(corTexto)
            telao.setCursorPos(x, y)
            telao.write(texto)
            
            -- Volta Ã  escala normal para outros efeitos
            telao.setTextScale(0.5)
        end
        os.sleep(0.05)
    end
end

-- =======================
-- NOVOS EFEITOS EXCLUSIVOS!
-- =======================

-- 3. EXPLOSÃƒO DE FOGOS DE ARTIFÃCIO
function efeitoFogosArtificio()
    print("ðŸŽ† Efeito: FOGOS DE ARTIFÃCIO")
    
    local fogos = {}
    
    for i = 1, #teloes do
        fogos[i] = {}
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Chance de criar novo fogo
            if math.random(1, 20) == 1 and #fogos[i] < 5 then
                local novoFogo = {
                    x = math.random(3, w - 3),
                    y = h,  -- ComeÃ§a embaixo
                    velocidade = math.random(2, 4),
                    explosaoY = math.random(3, math.floor(h * 0.7)),
                    explodiu = false,
                    particulas = {},
                    cor = coresShow[math.random(1, #coresShow)]
                }
                table.insert(fogos[i], novoFogo)
            end
            
            -- Atualiza fogos
            for j, fogo in ipairs(fogos[i]) do
                if not fogo.explodiu then
                    -- Subindo
                    fogo.y = fogo.y - fogo.velocidade
                    
                    -- Desenha rastro
                    telao.setBackgroundColor(colors.white)
                    telao.setCursorPos(fogo.x, fogo.y)
                    telao.write(" ")
                    
                    -- Verifica se explodiu
                    if fogo.y <= fogo.explosaoY then
                        fogo.explodiu = true
                        -- Cria partÃ­culas da explosÃ£o
                        for p = 1, 15 do
                            local angulo = math.random(1, 360)
                            local velocidade = math.random(1, 3) / 2
                            fogo.particulas[p] = {
                                x = fogo.x,
                                y = fogo.y,
                                dx = math.cos(math.rad(angulo)) * velocidade,
                                dy = math.sin(math.rad(angulo)) * velocidade,
                                vida = math.random(20, 40),
                                cor = coresShow[math.random(1, #coresShow)]
                            }
                        end
                    end
                else
                    -- Desenha explosÃ£o
                    for p, particula in ipairs(fogo.particulas) do
                        if particula.vida > 0 then
                            particula.x = particula.x + particula.dx
                            particula.y = particula.y + particula.dy
                            particula.vida = particula.vida - 1
                            
                            if particula.x >= 1 and particula.x <= w and particula.y >= 1 and particula.y <= h then
                                telao.setBackgroundColor(particula.cor)
                                telao.setCursorPos(math.floor(particula.x), math.floor(particula.y))
                                telao.write(" ")
                            end
                        end
                    end
                    
                    -- Remove fogo morto
                    local todasMortas = true
                    for p, particula in ipairs(fogo.particulas) do
                        if particula.vida > 0 then
                            todasMortas = false
                            break
                        end
                    end
                    
                    if todasMortas then
                        table.remove(fogos[i], j)
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 4. GIRASSOL PSICODÃ‰LICO
function efeitoGirassol()
    print("ðŸŒ» Efeito: GIRASSOL PSICODÃ‰LICO")
    
    local angulo = 0
    
    while true do
        angulo = angulo + 0.1
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            local centroX = math.floor(w / 2)
            local centroY = math.floor(h / 2)
            local raio = math.min(w, h) * 0.4
            
            -- Desenha pÃ©talas
            local numPetalas = 12
            for petala = 1, numPetalas do
                local anguloPetala = (petala * (360 / numPetalas) + angulo * 30) % 360
                local cor = coresShow[(petala + i - 1) % #coresShow + 1]
                
                -- PÃ©tala alongada
                for t = 0.3, 1.5, 0.2 do
                    local x = centroX + math.cos(math.rad(anguloPetala)) * raio * t
                    local y = centroY + math.sin(math.rad(anguloPetala)) * raio * t
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                        
                        -- Preenche ao redor para pÃ©talas maiores
                        telao.setCursorPos(x + 1, y)
                        telao.write(" ")
                        telao.setCursorPos(x - 1, y)
                        telao.write(" ")
                    end
                end
            end
            
            -- Centro do girassol
            telao.setBackgroundColor(colors.yellow)
            for y = -3, 3 do
                for x = -3, 3 do
                    if x*x + y*y <= 9 then
                        local posX = centroX + x
                        local posY = centroY + y
                        if posX >= 1 and posX <= w and posY >= 1 and posY <= h then
                            telao.setCursorPos(posX, posY)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.05)
    end
end

-- 5. TÃšNEL DIMENSIONAL
function efeitoTunel()
    print("ðŸŒ€ Efeito: TÃšNEL DIMENSIONAL")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.2
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            local centroX = math.floor(w / 2)
            local centroY = math.floor(h / 2)
            
            -- Desenha anÃ©is concÃªntricos
            local numAneis = 8
            for anel = 1, numAneis do
                local raio = anel * 2 + math.sin(tempo + anel) * 2
                local cor = coresShow[(anel + i - 1) % #coresShow + 1]
                
                for ang = 0, 360, 5 do
                    local x = centroX + math.cos(math.rad(ang)) * raio
                    local y = centroY + math.sin(math.rad(ang)) * raio
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 6. MATRIZ DIGITAL (efeito matrix)
function efeitoMatrix()
    print("ðŸ’š Efeito: MATRIZ DIGITAL")
    
    local caracteres = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"}
    local colunas = {}
    
    -- Inicializa colunas
    for i = 1, #teloes do
        local w, h = teloes[i].getSize()
        colunas[i] = {}
        for x = 1, w do
            colunas[i][x] = {
                posicao = math.random(1, h),
                velocidade = math.random(1, 3),
                caracteres = {}
            }
            -- Preenche caracteres iniciais
            for y = 1, h do
                colunas[i][x].caracteres[y] = {
                    char = caracteres[math.random(1, #caracteres)],
                    brilho = math.random(1, 3)
                }
            end
        end
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            telao.setTextColor(colors.green)
            
            -- Atualiza e desenha colunas
            for x = 1, w do
                local coluna = colunas[i][x]
                
                -- Move a coluna
                coluna.posicao = coluna.posicao + coluna.velocidade
                if coluna.posicao > h + 10 then
                    coluna.posicao = 1
                    coluna.velocidade = math.random(1, 3)
                end
                
                -- Desenha caracteres com efeito de rastro
                for y = 1, h do
                    local distancia = math.abs(y - coluna.posicao)
                    if distancia < 10 then
                        local brilho = math.max(1, 3 - math.floor(distancia / 3))
                        local charInfo = coluna.caracteres[y]
                        
                        if brilho == 3 then
                            telao.setTextColor(colors.lime)
                        elseif brilho == 2 then
                            telao.setTextColor(colors.green)
                        else
                            telao.setTextColor(colors.darkGreen)
                        end
                        
                        telao.setCursorPos(x, y)
                        telao.write(charInfo.char)
                        
                        -- Atualiza caractere ocasionalmente
                        if math.random(1, 10) == 1 then
                            charInfo.char = caracteres[math.random(1, #caracteres)]
                        end
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- Menu principal MEGA
function menuMega()
    print("\n" .. string.rep("=", 50))
    print("ðŸŽ¸ SHOW MEGA DOS TELÃ•ES - BALADA ðŸŽ¸")
    print(string.rep("=", 50))
    print("1.  ðŸ”¦ LASERS MEGA (Mais cores e feixes!)")
    print("2.  ðŸŽª TEXTO GIGANTE (Agora visÃ­vel!)")
    print("3.  ðŸŽ† FOGOS DE ARTIFÃCIO (Novo!)")
    print("4.  ðŸŒ» GIRASSOL PSICODÃ‰LICO (Novo!)")
    print("5.  ðŸŒ€ TÃšNEL DIMENSIONAL (Novo!)")
    print("6.  ðŸ’š MATRIZ DIGITAL (Novo!)")
    print("7.  ðŸŽµ Equalizador Musical")
    print("8.  âœ¨ PartÃ­culas DanÃ§antes")
    print("9.  ðŸ’“ PulsaÃ§Ã£o RÃ­tmica")
    print("10. ðŸŒŠ Ondas de Energia")
    print("11. ðŸ”„ Voltar")
    print("12. ðŸšª Sair")
    
    write("Escolha um efeito MEGA (1-12): ")
    local escolha = read()
    
    if escolha == "1" then
        efeitoLasersMega()
    elseif escolha == "2" then
        efeitoTextoGigante()
    elseif escolha == "3" then
        efeitoFogosArtificio()
    elseif escolha == "4" then
        efeitoGirassol()
    elseif escolha == "5" then
        efeitoTunel()
    elseif escolha == "6" then
        efeitoMatrix()
    elseif escolha == "7" then
        efeitoEqualizador()
    elseif escolha == "8" then
        efeitoParticulas()
    elseif escolha == "9" then
        efeitoPulsacao()
    elseif escolha == "10" then
        efeitoOndas()
    elseif escolha == "11" then
        return true
    elseif escolha == "12" then
        print("Show MEGA encerrado!")
        return false
    else
        print("OpÃ§Ã£o invÃ¡lida!")
        os.sleep(1)
    end
    return true
end

-- Programa principal
function main()
    print("SISTEMA MEGA DOS TELÃ•ES INICIADO! ðŸ’¥")
    print("TelÃµes prontos: " .. #teloes)
    
    while menuMega() do
        -- Continua no menu
    end
    
    -- Limpeza final
    for i, telao in ipairs(teloes) do
        telao.setBackgroundColor(colors.black)
        telao.clear()
        telao.setTextColor(colors.white)
    end
end

-- Inicia o show MEGA!
main()
