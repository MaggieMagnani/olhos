-- =============================================
-- SHOW VISUAL CORRIGIDO - TEL√ïES DIFERENTES
-- =============================================

print("=== SHOW CORRIGIDO DOS TEL√ïES ===")

-- Encontra os tel√µes
local teloes = {peripheral.find("monitor")}
if not teloes[1] then
    teloes = {teloes}
end

print("Tel√µes conectados: " .. #teloes)

-- Configura cada tel√£o individualmente
for i, telao in ipairs(teloes) do
    telao.setTextScale(0.5)
    local w, h = telao.getSize()
    print("Tel√£o " .. i .. ": " .. w .. "x" .. h)  -- Mostra tamanho de cada um
end

-- PALETA MEGA COLORIDA
local coresShow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white,
    colors.brown, colors.lightGray, colors.gray
}

-- =======================
-- FUN√á√ïES QUE ESTAVAM FALTANDO (6-10)
-- =======================

-- 7. EQUALIZADOR MUSICAL (que estava faltando)
function efeitoEqualizador()
    print("üéµ Efeito: Equalizador Musical")
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho INDIVIDUAL de cada tel√£o
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Desenha barras de equalizador
            local numBarras = 8
            local larguraBarra = math.floor(w / numBarras)
            
            for barra = 1, numBarras do
                local altura = math.random(1, h - 2)
                local cor = coresShow[math.random(1, #coresShow)]
                
                -- Desenha a barra
                for y = 1, altura do
                    for x = 1, larguraBarra - 1 do
                        local posX = (barra - 1) * larguraBarra + x
                        local posY = h - y  -- Come√ßa de baixo
                        
                        if posX <= w and posY <= h then
                            telao.setBackgroundColor(cor)
                            telao.setCursorPos(posX, posY)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.2)
    end
end

-- 8. PART√çCULAS DAN√áANTES (que estava faltando)
function efeitoParticulas()
    print("‚ú® Efeito: Part√≠culas Dan√ßantes")
    
    local particulas = {}
    
    -- Cria part√≠culas iniciais para CADA tel√£o
    for i = 1, #teloes do
        local w, h = teloes[i].getSize()  -- Tamanho individual
        particulas[i] = {}
        for j = 1, 15 do  -- Part√≠culas baseadas no tamanho
            particulas[i][j] = {
                x = math.random(1, w),
                y = math.random(1, h),
                dx = (math.random() - 0.5) * 2,
                dy = (math.random() - 0.5) * 2,
                cor = coresShow[math.random(1, #coresShow)],
                vida = math.random(50, 200)
            }
        end
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Atualiza e desenha part√≠culas
            for j, part in ipairs(particulas[i]) do
                -- Move part√≠cula
                part.x = part.x + part.dx
                part.y = part.y + part.dy
                
                -- Rebate nas bordas (usando tamanho individual)
                if part.x <= 1 or part.x >= w then part.dx = -part.dx end
                if part.y <= 1 or part.y >= h then part.dy = -part.dy end
                
                -- Mant√©m dentro dos limites
                part.x = math.max(1, math.min(w, part.x))
                part.y = math.max(1, math.min(h, part.y))
                
                -- Desenha part√≠cula
                telao.setBackgroundColor(part.cor)
                telao.setCursorPos(math.floor(part.x), math.floor(part.y))
                telao.write(" ")
                
                -- Reduz vida e reposiciona se morrer
                part.vida = part.vida - 1
                if part.vida <= 0 then
                    part.x = math.random(1, w)
                    part.y = math.random(1, h)
                    part.vida = math.random(50, 200)
                    part.cor = coresShow[math.random(1, #coresShow)]
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 9. PULSA√á√ÉO R√çTMICA (que estava faltando)
function efeitoPulsacao()
    print("üíì Efeito: Pulsa√ß√£o R√≠tmica")
    
    local pulsos = 0
    
    while true do
        pulsos = pulsos + 1
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            local cor = coresShow[(pulsos + i - 2) % #coresShow + 1]
            
            -- Calcula tamanho do pulso baseado no tamanho INDIVIDUAL
            local tamanho = math.floor(math.sin(pulsos * 0.5) * math.min(w, h) * 0.3 + math.min(w, h) * 0.5)
            
            telao.setBackgroundColor(cor)
            telao.clear()
            
            -- Desenha c√≠rculo pulsante
            local centroX = math.floor(w / 2)
            local centroY = math.floor(h / 2)
            
            for y = -tamanho, tamanho do
                for x = -tamanho, tamanho do
                    if x*x + y*y <= tamanho*tamanho then
                        local posX = centroX + x
                        local posY = centroY + y
                        
                        if posX >= 1 and posX <= w and posY >= 1 and posY <= h then
                            telao.setCursorPos(posX, posY)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.2)
    end
end

-- 10. ONDAS DE ENERGIA (que estava faltando)
function efeitoOndas()
    print("üåä Efeito: Ondas de Energia")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.3
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            local cor = coresShow[i]
            
            -- Desenha ondas baseadas no tamanho individual
            for x = 1, w do
                local onda1 = math.sin(x * 0.3 + tempo) * (h/4) + (h/2)
                local onda2 = math.cos(x * 0.2 + tempo * 1.3) * (h/5) + (h/2)
                
                local y1 = math.floor(onda1)
                local y2 = math.floor(onda2)
                
                if y1 >= 1 and y1 <= h then
                    telao.setBackgroundColor(cor)
                    telao.setCursorPos(x, y1)
                    telao.write(" ")
                end
                
                if y2 >= 1 and y2 <= h then
                    telao.setBackgroundColor(coresShow[(i % #coresShow) + 1])
                    telao.setCursorPos(x, y2)
                    telao.write(" ")
                end
            end
        end
        os.sleep(0.1)
    end
end

-- =======================
-- EFEITOS NOVOS (1-6) - AGORA ADAPTADOS
-- =======================

-- 1. LASERS MEGA COLORIDOS (adaptado para tamanhos diferentes)
function efeitoLasersMega()
    print("üî¶ Efeito: SHOW DE LASERS MEGA")
    
    local angulos = {}
    local coresLasers = {}
    
    for i = 1, #teloes do
        angulos[i] = math.random(1, 360)
        coresLasers[i] = {}
        for l = 1, 8 do
            coresLasers[i][l] = coresShow[math.random(1, #coresShow)]
        end
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            angulos[i] = (angulos[i] + math.random(8, 20)) % 360
            
            local numLasers = 8
            for laser = 1, numLasers do
                local angulo = angulos[i] + (laser * 360 / numLasers)
                local cor = coresLasers[i][laser]
                
                local centroX = math.floor(w / 2)
                local centroY = math.floor(h / 2)
                local raio = math.min(w, h) * 0.8  -- Usa o menor lado
                
                for t = 0, raio, 0.3 do
                    local x = centroX + math.cos(math.rad(angulo)) * t
                    local y = centroY + math.sin(math.rad(angulo)) * t
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 2. TEXTO GIGANTE (adaptado para tamanhos diferentes)
function efeitoTextoGigante()
    print("üé™ Efeito: TEXTO GIGANTE")
    
    local textos = {"BALADA", "FESTA", "SHOW", "DANCE", "DIVIRTA-SE"}
    local textoIndex = 1
    local frame = 0
    
    while true do
        frame = frame + 1
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            if frame % 40 == 0 then
                textoIndex = (textoIndex % #textos) + 1
            end
            
            local texto = textos[textoIndex]
            local corFundo = coresShow[(frame + i - 1) % #coresShow + 1]
            
            -- Escala o texto baseado no tamanho do tel√£o
            local escalaTexto = 1  -- Para tel√µes grandes
            if w < 10 then  -- Se tel√£o for pequeno
                escalaTexto = 0.5
            end
            
            telao.setTextScale(escalaTexto)
            
            local x = math.floor((w - #texto) / 2) + 1
            local y = math.floor(h / 2)
            
            -- Fundo colorido
            for bgX = math.max(1, x - 1), math.min(w, x + #texto + 1) do
                for bgY = math.max(1, y - 1), math.min(h, y + 1) do
                    telao.setBackgroundColor(corFundo)
                    telao.setCursorPos(bgX, bgY)
                    telao.write(" ")
                end
            end
            
            -- Texto
            telao.setBackgroundColor(corFundo)
            telao.setTextColor(colors.black)
            telao.setCursorPos(x, y)
            telao.write(texto)
            
            telao.setTextScale(0.5)  -- Volta ao normal
        end
        os.sleep(0.05)
    end
end

-- 3. FOGOS DE ARTIF√çCIO (adaptado)
function efeitoFogosArtificio()
    print("üéÜ Efeito: FOGOS DE ARTIF√çCIO")
    
    local fogos = {}
    
    for i = 1, #teloes do
        fogos[i] = {}
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()  -- Tamanho individual
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            if math.random(1, 20) == 1 and #fogos[i] < 3 then
                local novoFogo = {
                    x = math.random(3, w - 3),
                    y = h,
                    velocidade = math.random(2, 4),
                    explosaoY = math.random(3, math.floor(h * 0.7)),
                    explodiu = false,
                    particulas = {},
                    cor = coresShow[math.random(1, #coresShow)]
                }
                table.insert(fogos[i], novoFogo)
            end
            
            for j, fogo in ipairs(fogos[i]) do
                if not fogo.explodiu then
                    fogo.y = fogo.y - fogo.velocidade
                    
                    telao.setBackgroundColor(colors.white)
                    telao.setCursorPos(fogo.x, fogo.y)
                    telao.write(" ")
                    
                    if fogo.y <= fogo.explosaoY then
                        fogo.explodiu = true
                        for p = 1, 12 do
                            local angulo = math.random(1, 360)
                            local velocidade = math.random(1, 3) / 2
                            fogo.particulas[p] = {
                                x = fogo.x,
                                y = fogo.y,
                                dx = math.cos(math.rad(angulo)) * velocidade,
                                dy = math.sin(math.rad(angulo)) * velocidade,
                                vida = math.random(20, 40),
                                cor = coresShow[math.random(1, #coresShow)]
                            }
                        end
                    end
                else
                    for p, particula in ipairs(fogo.particulas) do
                        if particula.vida > 0 then
                            particula.x = particula.x + particula.dx
                            particula.y = particula.y + particula.dy
                            particula.vida = particula.vida - 1
                            
                            if particula.x >= 1 and particula.x <= w and particula.y >= 1 and particula.y <= h then
                                telao.setBackgroundColor(particula.cor)
                                telao.setCursorPos(math.floor(particula.x), math.floor(particula.y))
                                telao.write(" ")
                            end
                        end
                    end
                    
                    local todasMortas = true
                    for p, particula in ipairs(fogo.particulas) do
                        if particula.vida > 0 then
                            todasMortas = false
                            break
                        end
                    end
                    
                    if todasMortas then
                        table.remove(fogos[i], j)
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- Menu principal CORRIGIDO
function menuCorrigido()
    print("\n" .. string.rep("=", 50))
    print("üé∏ SHOW DOS TEL√ïES - TODOS EFEITOS FUNCIONANDO üé∏")
    print(string.rep("=", 50))
    print("1.  üî¶ LASERS MEGA")
    print("2.  üé™ TEXTO GIGANTE") 
    print("3.  üéÜ FOGOS DE ARTIF√çCIO")
    print("4.  üåª GIRASSOL PSICOD√âLICO")
    print("5.  üåÄ T√öNEL DIMENSIONAL")
    print("6.  üíö MATRIZ DIGITAL")
    print("7.  üéµ EQUALIZADOR MUSICAL")
    print("8.  ‚ú® PART√çCULAS DAN√áANTES")
    print("9.  üíì PULSA√á√ÉO R√çTMICA")
    print("10. üåä ONDAS DE ENERGIA")
    print("11. üîÑ Voltar")
    print("12. üö™ Sair")
    
    write("Escolha um efeito (1-12): ")
    local escolha = read()
    
    -- Adicione aqui as fun√ß√µes 4-6 se quiser (Girassol, T√∫nel, Matriz)
    if escolha == "1" then
        efeitoLasersMega()
    elseif escolha == "2" then
        efeitoTextoGigante()
    elseif escolha == "3" then
        efeitoFogosArtificio()
    elseif escolha == "4" then
        print("Girassol em desenvolvimento...")
        os.sleep(2)
    elseif escolha == "5" then
        print("T√∫nel em desenvolvimento...")
        os.sleep(2)
    elseif escolha == "6" then
        print("Matriz em desenvolvimento...")
        os.sleep(2)
    elseif escolha == "7" then
        efeitoEqualizador()
    elseif escolha == "8" then
        efeitoParticulas()
    elseif escolha == "9" then
        efeitoPulsacao()
    elseif escolha == "10" then
        efeitoOndas()
    elseif escolha == "11" then
        return true
    elseif escolha == "12" then
        print("Show encerrado!")
        return false
    else
        print("Op√ß√£o inv√°lida!")
        os.sleep(1)
    end
    return true
end

-- Programa principal
function main()
    print("SISTEMA CORRIGIDO INICIADO! ‚úÖ")
    print("Tel√µes detectados: " .. #teloes)
    
    -- Mostra tamanhos individuais
    for i, telao in ipairs(teloes) do
        local w, h = telao.getSize()
        print("Tel√£o " .. i .. " tamanho: " .. w .. "x" .. h)
    end
    
    while menuCorrigido() do
        -- Continua no menu
    end
    
    -- Limpeza final
    for i, telao in ipairs(teloes) do
        telao.setBackgroundColor(colors.black)
        telao.clear()
        telao.setTextColor(colors.white)
        telao.setTextScale(0.5)
    end
end

-- Inicia o show corrigido!
main()
