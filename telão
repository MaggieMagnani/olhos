-- =============================================
-- SHOW BALADA - TELAS ILIMITADAS
-- =============================================

print("=== SHOW BALADA - TELAS ILIMITADAS ===")

-- Encontra TODOS os monitores (quantos quiser)
local monitores = {peripheral.find("monitor")}
if not monitores[1] then
    monitores = {monitores}
end

if #monitores == 0 then
    print("ERRO: Nenhum monitor encontrado!")
    return
end

print("Monitores conectados: " .. #monitores)

-- Configura todos os monitores
for i, mon in ipairs(monitores) do
    mon.setTextScale(0.5)
end

-- Calcula tamanho total da tela gigante
local larguras = {}
local larguraTotal = 0
local alturaTotal = 0

for i, mon in ipairs(monitores) do
    local w, h = mon.getSize()
    larguras[i] = w
    larguraTotal = larguraTotal + w
    if h > alturaTotal then
        alturaTotal = h
    end
    print("Monitor " .. i .. ": " .. w .. "x" .. h)
end

print("Tela gigante: " .. larguraTotal .. "x" .. alturaTotal)

-- Cores para balada
local cores = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white
}

-- Função para desenhar na tela gigante
function desenhar(x, y, cor)
    local xAtual = 0
    for i, mon in ipairs(monitores) do
        local w = larguras[i]
        if x >= xAtual and x < xAtual + w and y >= 1 and y <= alturaTotal then
            local xLocal = x - xAtual + 1
            mon.setBackgroundColor(cor)
            mon.setCursorPos(xLocal, y)
            mon.write(" ")
            return
        end
        xAtual = xAtual + w
    end
end

-- 1. LASERS CORRETO (consertado)
function lasers()
    print("Lasers Ativado")
    
    local angulos = {}
    for i = 1, 6 do angulos[i] = math.random(0, 360) end
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Atualizar lasers
        for i, angulo in ipairs(angulos) do
            angulos[i] = (angulo + math.random(10, 20)) % 360
            local cor = cores[(i - 1) % #cores + 1]
            local centroX = math.floor(larguraTotal / 2)
            local centroY = math.floor(alturaTotal / 2)
            local raio = math.max(larguraTotal, alturaTotal) * 0.8
            
            -- Desenhar laser
            for t = 0, raio, 0.8 do
                local x = centroX + math.cos(math.rad(angulo)) * t
                local y = centroY + math.sin(math.rad(angulo)) * t
                x = math.floor(x)
                y = math.floor(y)
                if x >= 1 and x <= larguraTotal and y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 2. FOGOS ARTIFICIO (já estava bom)
function fogos()
    print("Fogos Ativado")
    
    local fogos = {}
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Novo fogo
        if math.random(1, 10) == 1 and #fogos < 5 then
            table.insert(fogos, {
                x = math.random(5, larguraTotal - 5),
                y = alturaTotal,
                vel = math.random(3, 6),
                explosaoY = math.random(10, math.floor(alturaTotal * 0.4)),
                explodiu = false,
                partes = {},
                cor = cores[math.random(1, #cores)]
            })
        end
        
        -- Atualizar fogos
        for i = #fogos, 1, -1 do
            local f = fogos[i]
            
            if not f.explodiu then
                f.y = f.y - f.vel
                desenhar(f.x, f.y, colors.white)
                
                if f.y <= f.explosaoY then
                    f.explodiu = true
                    for p = 1, 20 do
                        local ang = math.random(0, 360)
                        local vel = math.random(1, 3) / 1.5
                        f.partes[p] = {
                            x = f.x, y = f.y,
                            dx = math.cos(math.rad(ang)) * vel,
                            dy = math.sin(math.rad(ang)) * vel,
                            vida = math.random(30, 50),
                            cor = cores[math.random(1, #cores)]
                        }
                    end
                end
            else
                local todasMortas = true
                for p, parte in ipairs(f.partes) do
                    if parte.vida > 0 then
                        todasMortas = false
                        parte.x = parte.x + parte.dx
                        parte.y = parte.y + parte.dy
                        parte.vida = parte.vida - 1
                        if parte.x >= 1 and parte.x <= larguraTotal and parte.y >= 1 and parte.y <= alturaTotal then
                            desenhar(math.floor(parte.x), math.floor(parte.y), parte.cor)
                        end
                    end
                end
                if todasMortas then
                    table.remove(fogos, i)
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 3. TUNEL FUNCIONANDO (consertado)
function tunel()
    print("Tunel Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.3
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        local centroX = math.floor(larguraTotal / 2)
        local centroY = math.floor(alturaTotal / 2)
        
        -- Desenhar anéis do túnel
        for anel = 1, 10 do
            local raio = anel * 3 + math.sin(tempo + anel) * 2
            local cor = cores[anel % #cores + 1]
            
            for angulo = 0, 360, 8 do
                local x = centroX + math.cos(math.rad(angulo)) * raio
                local y = centroY + math.sin(math.rad(angulo)) * raio
                x = math.floor(x)
                y = math.floor(y)
                if x >= 1 and x <= larguraTotal and y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                end
            end
        end
        
        -- Centro do túnel
        local centroRaio = 4 + math.sin(tempo * 2) * 2
        for y = -centroRaio, centroRaio do
            for x = -centroRaio, centroRaio do
                if x*x + y*y <= centroRaio*centroRaio then
                    local px = centroX + x
                    local py = centroY + y
                    if px >= 1 and px <= larguraTotal and py >= 1 and py <= alturaTotal then
                        desenhar(px, py, colors.white)
                    end
                end
            end
        end
        
        os.sleep(0.1)
    end
end

-- 4. PULSACOES COLORIDAS (novo - substitui o 4 antigo)
function pulsacoes()
    print("Pulsacoes Coloridas Ativado")
    
    local pulsos = 0
    
    while true do
        pulsos = pulsos + 1
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Criar pulsos concêntricos
        for camada = 1, 8 do
            local raio = (math.sin(pulsos * 0.2 + camada * 0.5) + 1) * math.min(larguraTotal, alturaTotal) * 0.2
            local cor = cores[(camada + pulsos) % #cores + 1]
            
            local centroX = math.floor(larguraTotal / 2)
            local centroY = math.floor(alturaTotal / 2)
            
            for y = -math.floor(raio), math.floor(raio) do
                for x = -math.floor(raio), math.floor(raio) do
                    if x*x + y*y <= raio*raio then
                        local px = centroX + x
                        local py = centroY + y
                        if px >= 1 and px <= larguraTotal and py >= 1 and py <= alturaTotal then
                            desenhar(px, py, cor)
                        end
                    end
                end
            end
        end
        
        os.sleep(0.15)
    end
end

-- 5. CHUVA DE LUZES (novo - substitui o 5 antigo)
function chuvaLuzes()
    print("Chuva de Luzes Ativado")
    
    local gotas = {}
    
    while true do
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Nova gota
        if math.random(1, 3) == 1 then
            table.insert(gotas, {
                x = math.random(1, larguraTotal),
                y = 1,
                velocidade = math.random(2, 5),
                cor = cores[math.random(1, #cores)]
            })
        end
        
        -- Atualizar gotas
        for i = #gotas, 1, -1 do
            local g = gotas[i]
            
            -- Desenhar gota com rastro
            for r = 0, 3 do
                local yRastro = g.y - r
                if yRastro >= 1 and yRastro <= alturaTotal then
                    desenhar(g.x, yRastro, g.cor)
                end
            end
            
            -- Mover gota
            g.y = g.y + g.velocidade
            
            -- Remover se saiu da tela
            if g.y > alturaTotal + 5 then
                table.remove(gotas, i)
            end
        end
        
        -- Fundo com pontos de luz
        for p = 1, math.floor(larguraTotal * alturaTotal * 0.01) do
            local x = math.random(1, larguraTotal)
            local y = math.random(1, alturaTotal)
            if math.random(1, 4) == 1 then
                desenhar(x, y, colors.white)
            end
        end
        
        os.sleep(0.1)
    end
end

-- 6. ONDAS COLORIDAS (já estava bom)
function ondas()
    print("Ondas Coloridas Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.2
        
        -- Limpar
        for i, mon in ipairs(monitores) do
            mon.setBackgroundColor(colors.black)
            mon.clear()
        end
        
        -- Múltiplas ondas coloridas
        for onda = 1, 5 do
            local cor = cores[onda % #cores + 1]
            local freq = 0.1 + onda * 0.03
            local amp = alturaTotal * 0.15
            local offset = onda * 0.8
            
            for x = 1, larguraTotal do
                local y = math.sin(x * freq + tempo + offset) * amp + alturaTotal / 2
                y = math.floor(y)
                
                if y >= 1 and y <= alturaTotal then
                    desenhar(x, y, cor)
                    -- Tornar a onda mais grossa
                    if y > 1 then desenhar(x, y - 1, cor) end
                    if y < alturaTotal then desenhar(x, y + 1, cor) end
                end
            end
        end
        
        os.sleep(0.1)
    end
end

-- Menu
function menu()
    print("\n" .. string.rep("=", 40))
    print("SHOW BALADA - " .. #monitores .. " TELAS")
    print(string.rep("=", 40))
    print("1. Lasers (Consertado)")
    print("2. Fogos Artificial")
    print("3. Tunel (Consertado)")
    print("4. Pulsacoes Coloridas (Novo)")
    print("5. Chuva de Luzes (Novo)")
    print("6. Ondas Coloridas")
    print(string.rep("=", 40))
    
    write("Escolha (1-6): ")
    local escolha = read()
    
    if escolha == "1" then lasers()
    elseif escolha == "2" then fogos()
    elseif escolha == "3" then tunel()
    elseif escolha == "4" then pulsacoes()
    elseif escolha == "5" then chuvaLuzes()
    elseif escolha == "6" then ondas()
    else
        print("Opcao invalida!")
        os.sleep(1)
    end
end

-- Programa principal
function main()
    print("Sistema pronto! Pressione Ctrl+T para parar qualquer efeito")
    
    while true do
        menu()
    end
end

-- Iniciar
main()
