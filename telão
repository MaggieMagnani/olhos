-- =============================================
-- SHOW DE LUZES - TELOES DA BALADA
-- =============================================

print("=== SHOW DE LUZES INICIADO ===")

-- Encontra os teloes
local teloes = {peripheral.find("monitor")}
if not teloes[1] then
    teloes = {teloes}
end

print("Telões conectados: " .. #teloes)

-- Configura cada telão
for i, telao in ipairs(teloes) do
    telao.setTextScale(0.5)
end

-- Cores vibrantes
local coresShow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white
}

-- 1. SHOW DE LASERS
function efeitoLasers()
    print("Lasers Ativado")
    
    local angulos = {}
    for i = 1, #teloes do
        angulos[i] = math.random(1, 360)
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            angulos[i] = (angulos[i] + math.random(10, 25)) % 360
            
            local numLasers = 8
            for laser = 1, numLasers do
                local angulo = angulos[i] + (laser * 360 / numLasers)
                local cor = coresShow[laser % #coresShow + 1]
                
                local centroX = math.floor(w / 2)
                local centroY = math.floor(h / 2)
                local raio = math.min(w, h) * 0.9
                
                for t = 0, raio, 0.3 do
                    local x = centroX + math.cos(math.rad(angulo)) * t
                    local y = centroY + math.sin(math.rad(angulo)) * t
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 2. SHOW DE LUZES (substitui o texto)
function efeitoLuzes()
    print("Show de Luzes Ativado")
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            
            -- Preenche com cor sólida
            local cor = coresShow[math.random(1, #coresShow)]
            telao.setBackgroundColor(cor)
            telao.clear()
            
            -- Adiciona pontos de luz aleatórios
            for ponto = 1, math.floor(w * h * 0.1) do
                local x = math.random(1, w)
                local y = math.random(1, h)
                local corPonto = coresShow[math.random(1, #coresShow)]
                
                telao.setBackgroundColor(corPonto)
                telao.setCursorPos(x, y)
                telao.write(" ")
            end
        end
        os.sleep(0.3)
    end
end

-- 3. FOGOS DE ARTIFICIO
function efeitoFogos()
    print("Fogos de Artificio Ativado")
    
    local fogos = {}
    for i = 1, #teloes do fogos[i] = {} end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            if math.random(1, 10) == 1 and #fogos[i] < 4 then
                table.insert(fogos[i], {
                    x = math.random(3, w - 3),
                    y = h,
                    velocidade = math.random(2, 5),
                    explosaoY = math.random(3, math.floor(h * 0.5)),
                    explodiu = false,
                    particulas = {},
                    cor = coresShow[math.random(1, #coresShow)]
                })
            end
            
            for j = #fogos[i], 1, -1 do
                local fogo = fogos[i][j]
                
                if not fogo.explodiu then
                    fogo.y = fogo.y - fogo.velocidade
                    
                    telao.setBackgroundColor(colors.white)
                    telao.setCursorPos(fogo.x, fogo.y)
                    telao.write(" ")
                    
                    if fogo.y <= fogo.explosaoY then
                        fogo.explodiu = true
                        for p = 1, 15 do
                            fogo.particulas[p] = {
                                x = fogo.x, y = fogo.y,
                                dx = (math.random() - 0.5) * 4,
                                dy = (math.random() - 0.5) * 4,
                                vida = math.random(25, 50),
                                cor = coresShow[math.random(1, #coresShow)]
                            }
                        end
                    end
                else
                    local todasMortas = true
                    for p, particula in ipairs(fogo.particulas) do
                        if particula.vida > 0 then
                            todasMortas = false
                            particula.x = particula.x + particula.dx
                            particula.y = particula.y + particula.dy
                            particula.vida = particula.vida - 1
                            
                            if particula.x >= 1 and particula.x <= w and particula.y >= 1 and particula.y <= h then
                                telao.setBackgroundColor(particula.cor)
                                telao.setCursorPos(math.floor(particula.x), math.floor(particula.y))
                                telao.write(" ")
                            end
                        end
                    end
                    
                    if todasMortas then
                        table.remove(fogos[i], j)
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 4. TUNEL GIGANTE (aumentado)
function efeitoTunelGigante()
    print("Tunel Gigante Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.3
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            local centroX = math.floor(w / 2)
            local centroY = math.floor(h / 2)
            
            -- Anéis maiores
            local numAneis = 8
            for anel = 1, numAneis do
                local raio = anel * 3 + math.sin(tempo + anel * 0.7) * 4
                local cor = coresShow[(anel + i - 1) % #coresShow + 1]
                
                for ang = 0, 360, 8 do
                    local x = centroX + math.cos(math.rad(ang)) * raio
                    local y = centroY + math.sin(math.rad(ang)) * raio
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        telao.setBackgroundColor(cor)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                    end
                end
            end
            
            -- Centro maior
            local centroRaio = math.floor(math.sin(tempo * 2) * 3 + 5)
            for y = -centroRaio, centroRaio do
                for x = -centroRaio, centroRaio do
                    if x*x + y*y <= centroRaio*centroRaio then
                        local posX = centroX + x
                        local posY = centroY + y
                        if posX >= 1 and posX <= w and posY >= 1 and posY <= h then
                            telao.setBackgroundColor(colors.white)
                            telao.setCursorPos(posX, posY)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 5. MATRIZ CORRIGIDA
function efeitoMatrix()
    print("Matrix Ativado")
    
    local caracteres = {"0", "1"}
    local colunas = {}
    
    for i = 1, #teloes do
        local w, h = teloes[i].getSize()
        colunas[i] = {}
        for x = 1, w do
            colunas[i][x] = {
                posicao = math.random(-5, h),
                velocidade = math.random(1, 4)
            }
        end
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            telao.setTextColor(colors.green)
            
            for x = 1, w do
                local coluna = colunas[i][x]
                
                coluna.posicao = coluna.posicao + coluna.velocidade
                if coluna.posicao > h + 15 then
                    coluna.posicao = -5
                end
                
                for y = 1, h do
                    local distancia = math.abs(y - coluna.posicao)
                    if distancia < 12 then
                        local brilho = math.max(1, 3 - math.floor(distancia / 4))
                        
                        if brilho == 3 then
                            telao.setTextColor(colors.lime)
                        elseif brilho == 2 then
                            telao.setTextColor(colors.green)
                        else
                            telao.setTextColor(colors.darkGreen)
                        end
                        
                        local char = caracteres[math.random(1, #caracteres)]
                        telao.setCursorPos(x, y)
                        telao.write(char)
                    end
                end
            end
        end
        os.sleep(0.08)
    end
end

-- 6. PULSACOES ENERGETICAS (novo)
function efeitoPulsacoes()
    print("Pulsacoes Energeticas Ativado")
    
    local pulsos = 0
    
    while true do
        pulsos = pulsos + 1
        
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            
            -- Fundo colorido pulsante
            local corFundo = coresShow[(pulsos + i - 1) % #coresShow + 1]
            telao.setBackgroundColor(corFundo)
            telao.clear()
            
            -- Ondas de energia
            local tempo = os.clock()
            for x = 1, w do
                for y = 1, h do
                    local onda = math.sin(x * 0.2 + tempo * 3) + math.cos(y * 0.2 + tempo * 2)
                    if onda > 0.5 then
                        local corOnda = coresShow[(x + y + pulsos) % #coresShow + 1]
                        telao.setBackgroundColor(corOnda)
                        telao.setCursorPos(x, y)
                        telao.write(" ")
                    end
                end
            end
        end
        os.sleep(0.2)
    end
end

-- 7. ESTRELAS CADENTES (novo)
function efeitoEstrelas()
    print("Estrelas Cadentes Ativado")
    
    local estrelas = {}
    for i = 1, #teloes do estrelas[i] = {} end
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            -- Chance de nova estrela
            if math.random(1, 8) == 1 then
                table.insert(estrelas[i], {
                    x = math.random(1, w),
                    y = 1,
                    velocidade = math.random(3, 6),
                    comprimento = math.random(3, 8),
                    cor = coresShow[math.random(1, #coresShow)]
                })
            end
            
            -- Atualiza estrelas
            for j = #estrelas[i], 1, -1 do
                local estrela = estrelas[i][j]
                
                -- Desenha rastro
                for k = 0, estrela.comprimento do
                    local x = estrela.x - k
                    local y = estrela.y - k
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        local intensidade = 1 - (k / estrela.comprimento)
                        if intensidade > 0.3 then
                            telao.setBackgroundColor(estrela.cor)
                            telao.setCursorPos(x, y)
                            telao.write(" ")
                        end
                    end
                end
                
                -- Move estrela
                estrela.y = estrela.y + estrela.velocidade
                
                -- Remove se saiu da tela
                if estrela.y > h + estrela.comprimento then
                    table.remove(estrelas[i], j)
                end
            end
            
            -- Estrelas fixas de fundo
            for s = 1, math.floor(w * h * 0.02) do
                local x = math.random(1, w)
                local y = math.random(1, h)
                if math.random(1, 4) == 1 then
                    telao.setBackgroundColor(colors.white)
                    telao.setCursorPos(x, y)
                    telao.write(" ")
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 8. EQUALIZADOR MUSICAL
function efeitoEqualizador()
    print("Equalizador Musical Ativado")
    
    while true do
        for i, telao in ipairs(teloes) do
            local w, h = telao.getSize()
            telao.setBackgroundColor(colors.black)
            telao.clear()
            
            local numBarras = 10
            local larguraBarra = math.floor(w / numBarras)
            
            for barra = 1, numBarras do
                local altura = math.random(1, h)
                local cor = coresShow[barra % #coresShow + 1]
                
                for y = 1, altura do
                    for x = 1, larguraBarra - 1 do
                        local posX = (barra - 1) * larguraBarra + x
                        local posY = h - y
                        
                        if posX <= w and posY >= 1 then
                            telao.setBackgroundColor(cor)
                            telao.setCursorPos(posX, posY)
                            telao.write(" ")
                        end
                    end
                end
            end
        end
        os.sleep(0.15)
    end
end

-- Menu principal simplificado
function menu()
    print("\n==========================================")
    print("SHOW DE LUZES - BALADA")
    print("==========================================")
    print("1. Lasers")
    print("2. Show de Luzes") 
    print("3. Fogos de Artificio")
    print("4. Tunel Gigante")
    print("5. Matrix")
    print("6. Pulsacoes Energeticas")
    print("7. Estrelas Cadentes")
    print("8. Equalizador Musical")
    print("==========================================")
    
    write("Escolha um efeito (1-8): ")
    local escolha = read()
    
    if escolha == "1" then
        efeitoLasers()
    elseif escolha == "2" then
        efeitoLuzes()
    elseif escolha == "3" then
        efeitoFogos()
    elseif escolha == "4" then
        efeitoTunelGigante()
    elseif escolha == "5" then
        efeitoMatrix()
    elseif escolha == "6" then
        efeitoPulsacoes()
    elseif escolha == "7" then
        efeitoEstrelas()
    elseif escolha == "8" then
        efeitoEqualizador()
    else
        print("Opcao invalida! Use 1-8")
        os.sleep(1)
    end
end

-- Programa principal
function main()
    print("Sistema de Show de Luzes Iniciado")
    
    while true do
        menu()
    end
end

-- Inicia o show
main()
