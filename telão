-- =============================================
-- SHOW PARA TELÃO GIGANTE - 3 TELAS CONECTADAS
-- =============================================

print("=== SHOW PARA TELÃO GIGANTE ===")

-- Encontra os teloes
local teloes = {peripheral.find("monitor")}
if not teloes[1] then
    teloes = {teloes}
end

print("Telões conectados: " .. #teloes)

-- Configura cada telão
for i, telao in ipairs(teloes) do
    telao.setTextScale(0.5)
end

-- Calcula tamanho total do telão gigante
local larguras = {}
local larguraTotal = 0
local alturaTotal = 0

for i, telao in ipairs(teloes) do
    local w, h = telao.getSize()
    larguras[i] = w
    larguraTotal = larguraTotal + w
    if h > alturaTotal then
        alturaTotal = h
    end
end

print("Telão gigante: " .. larguraTotal .. "x" .. alturaTotal)

-- Cores vibrantes
local coresShow = {
    colors.red, colors.orange, colors.yellow,
    colors.lime, colors.green, colors.cyan,
    colors.lightBlue, colors.blue, colors.purple,
    colors.pink, colors.magenta, colors.white
}

-- Função para desenhar no telão gigante
function desenharNoTelaGigante(x, y, cor)
    local xAtual = 0
    
    for i, telao in ipairs(teloes) do
        local w = larguras[i]
        local h = alturaTotal
        
        if x >= xAtual and x < xAtual + w and y >= 1 and y <= h then
            local xLocal = x - xAtual + 1
            local yLocal = y
            
            telao.setBackgroundColor(cor)
            telao.setCursorPos(xLocal, yLocal)
            telao.write(" ")
            return true
        end
        
        xAtual = xAtual + w
    end
    return false
end

-- 1. LASERS GIGANTES (atravessa todas as telas)
function efeitoLasersGigantes()
    print("Lasers Gigantes Ativado")
    
    local angulos = {0, 45, 90, 135, 180, 225}
    
    while true do
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        -- Atualiza ângulos
        for i, angulo in ipairs(angulos) do
            angulos[i] = (angulo + math.random(5, 15)) % 360
        end
        
        -- Desenha lasers que atravessam TODO o telão gigante
        for i, angulo in ipairs(angulos) do
            local cor = coresShow[i % #coresShow + 1]
            local centroX = math.floor(larguraTotal / 2)
            local centroY = math.floor(alturaTotal / 2)
            local raio = math.max(larguraTotal, alturaTotal)
            
            for t = 0, raio, 0.5 do
                local x = centroX + math.cos(math.rad(angulo)) * t
                local y = centroY + math.sin(math.rad(angulo)) * t
                
                x = math.floor(x)
                y = math.floor(y)
                
                desenharNoTelaGigante(x, y, cor)
            end
        end
        os.sleep(0.1)
    end
end

-- 2. FOGOS MELHORADOS (usando telão gigante)
function efeitoFogosMelhorados()
    print("Fogos Melhorados Ativado")
    
    local fogos = {}
    
    while true do
        -- Limpa tudo
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        -- Novo fogo
        if math.random(1, 8) == 1 and #fogos < 6 then
            table.insert(fogos, {
                x = math.random(3, larguraTotal - 3),
                y = alturaTotal,
                velocidade = math.random(3, 6),
                explosaoY = math.random(5, math.floor(alturaTotal * 0.4)),
                explodiu = false,
                particulas = {},
                cor = coresShow[math.random(1, #coresShow)]
            })
        end
        
        -- Atualiza fogos
        for j = #fogos, 1, -1 do
            local fogo = fogos[j]
            
            if not fogo.explodiu then
                fogo.y = fogo.y - fogo.velocidade
                
                -- Rastro
                desenharNoTelaGigante(fogo.x, fogo.y, colors.white)
                desenharNoTelaGigante(fogo.x + 1, fogo.y, colors.gray)
                desenharNoTelaGigante(fogo.x - 1, fogo.y, colors.gray)
                
                if fogo.y <= fogo.explosaoY then
                    fogo.explodiu = true
                    -- Explosão maior
                    for p = 1, 25 do
                        local angulo = math.random(1, 360)
                        local velocidade = math.random(1, 4) / 1.5
                        fogos[j].particulas[p] = {
                            x = fogo.x,
                            y = fogo.y,
                            dx = math.cos(math.rad(angulo)) * velocidade,
                            dy = math.sin(math.rad(angulo)) * velocidade,
                            vida = math.random(30, 60),
                            cor = coresShow[math.random(1, #coresShow)]
                        }
                    end
                end
            else
                local todasMortas = true
                for p, particula in ipairs(fogo.particulas) do
                    if particula.vida > 0 then
                        todasMortas = false
                        particula.x = particula.x + particula.dx
                        particula.y = particula.y + particula.dy
                        particula.vida = particula.vida - 1
                        
                        desenharNoTelaGigante(math.floor(particula.x), math.floor(particula.y), particula.cor)
                        
                        -- Efeito de brilho nas partículas
                        if particula.vida > 20 then
                            desenharNoTelaGigante(math.floor(particula.x) + 1, math.floor(particula.y), particula.cor)
                            desenharNoTelaGigante(math.floor(particula.x) - 1, math.floor(particula.y), particula.cor)
                        end
                    end
                end
                
                if todasMortas then
                    table.remove(fogos, j)
                end
            end
        end
        os.sleep(0.1)
    end
end

-- 3. TUNEL GIGANTE AUMENTADO
function efeitoTunelGigante()
    print("Tunel Gigante Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.4
        
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        local centroX = math.floor(larguraTotal / 2)
        local centroY = math.floor(alturaTotal / 2)
        
        -- Anéis muito maiores
        local numAneis = 12
        for anel = 1, numAneis do
            local raio = anel * 4 + math.sin(tempo + anel * 0.5) * 6
            local cor = coresShow[anel % #coresShow + 1]
            
            for ang = 0, 360, 5 do
                local x = centroX + math.cos(math.rad(ang)) * raio
                local y = centroY + math.sin(math.rad(ang)) * raio
                
                x = math.floor(x)
                y = math.floor(y)
                
                desenharNoTelaGigante(x, y, cor)
            end
        end
        
        -- Centro gigante
        local centroRaio = math.floor(math.sin(tempo * 3) * 4 + 8)
        for y = -centroRaio, centroRaio do
            for x = -centroRaio, centroRaio do
                if x*x + y*y <= centroRaio*centroRaio then
                    local posX = centroX + x
                    local posY = centroY + y
                    desenharNoTelaGigante(posX, posY, colors.white)
                end
            end
        end
        
        os.sleep(0.1)
    end
end

-- 4. MATRIZ CORRIGIDA (telão gigante)
function efeitoMatrixCorrigido()
    print("Matrix Corrigido Ativado")
    
    local caracteres = {"0", "1", " "}
    local colunas = {}
    
    -- Inicializa colunas para o telão gigante
    for x = 1, larguraTotal do
        colunas[x] = {
            posicao = math.random(-20, alturaTotal),
            velocidade = math.random(2, 5)
        }
    end
    
    while true do
        -- Limpa tudo
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
            telao.setTextColor(colors.green)
        end
        
        -- Atualiza e desenha colunas
        for x = 1, larguraTotal do
            local coluna = colunas[x]
            
            coluna.posicao = coluna.posicao + coluna.velocidade
            if coluna.posicao > alturaTotal + 30 then
                coluna.posicao = -10
                coluna.velocidade = math.random(2, 5)
            end
            
            -- Desenha coluna
            for y = 1, alturaTotal do
                local distancia = math.abs(y - coluna.posicao)
                if distancia < 15 then
                    local brilho = math.max(1, 3 - math.floor(distancia / 5))
                    
                    local xAtual = 0
                    for i, telao in ipairs(teloes) do
                        local w = larguras[i]
                        if x >= xAtual and x < xAtual + w then
                            local xLocal = x - xAtual + 1
                            
                            if brilho == 3 then
                                telao.setTextColor(colors.lime)
                            elseif brilho == 2 then
                                telao.setTextColor(colors.green)
                            else
                                telao.setTextColor(colors.darkGreen)
                            end
                            
                            local char = caracteres[math.random(1, #caracteres)]
                            telao.setCursorPos(xLocal, y)
                            telao.write(char)
                            break
                        end
                        xAtual = xAtual + w
                    end
                end
            end
        end
        os.sleep(0.08)
    end
end

-- 5. ESTRELAS CADENTES MELHORADAS
function efeitoEstrelasMelhoradas()
    print("Estrelas Cadentes Melhoradas Ativado")
    
    local estrelas = {}
    
    while true do
        -- Limpa tudo
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        -- Nova estrela
        if math.random(1, 5) == 1 then
            table.insert(estrelas, {
                x = math.random(1, larguraTotal),
                y = 1,
                velocidade = math.random(4, 8),
                comprimento = math.random(8, 15),
                cor = coresShow[math.random(1, #coresShow)]
            })
        end
        
        -- Estrelas fixas de fundo
        for s = 1, math.floor(larguraTotal * alturaTotal * 0.01) do
            local x = math.random(1, larguraTotal)
            local y = math.random(1, alturaTotal)
            if math.random(1, 3) == 1 then
                desenharNoTelaGigante(x, y, colors.white)
            end
        end
        
        -- Atualiza estrelas cadentes
        for j = #estrelas, 1, -1 do
            local estrela = estrelas[j]
            
            -- Desenha rastro longo
            for k = 0, estrela.comprimento do
                local x = estrela.x - k
                local y = estrela.y - k
                
                local intensidade = 1 - (k / estrela.comprimento)
                if intensidade > 0.2 then
                    desenharNoTelaGigante(x, y, estrela.cor)
                end
            end
            
            -- Move estrela
            estrela.y = estrela.y + estrela.velocidade
            
            -- Remove se saiu da tela
            if estrela.y > alturaTotal + estrela.comprimento then
                table.remove(estrelas, j)
            end
        end
        
        os.sleep(0.1)
    end
end

-- 6. EQUALIZADOR SINCRONIZADO (todas as telas juntas)
function efeitoEqualizadorSincronizado()
    print("Equalizador Sincronizado Ativado")
    
    local alturas = {}
    for i = 1, 12 do
        alturas[i] = math.random(1, alturaTotal)
    end
    
    while true do
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        -- Atualiza alturas das barras
        for i, altura in ipairs(alturas) do
            alturas[i] = math.random(math.max(1, altura - 3), math.min(alturaTotal, altura + 3))
        end
        
        -- Desenha equalizador sincronizado
        local numBarras = 12
        local larguraBarra = math.floor(larguraTotal / numBarras)
        
        for barra = 1, numBarras do
            local altura = alturas[barra]
            local cor = coresShow[barra % #coresShow + 1]
            
            for y = 1, altura do
                for x = 1, larguraBarra - 1 do
                    local posX = (barra - 1) * larguraBarra + x
                    local posY = alturaTotal - y
                    
                    desenharNoTelaGigante(posX, posY, cor)
                end
            end
        end
        
        os.sleep(0.15)
    end
end

-- 7. ONDAS GIGANTES (novo efeito que atravessa todas as telas)
function efeitoOndasGigantes()
    print("Ondas Gigantes Ativado")
    
    local tempo = 0
    
    while true do
        tempo = tempo + 0.2
        
        for i, telao in ipairs(teloes) do
            telao.setBackgroundColor(colors.black)
            telao.clear()
        end
        
        -- Múltiplas ondas que atravessam todo o telão
        for onda = 1, 4 do
            local cor = coresShow[onda % #coresShow + 1]
            local frequencia = 0.1 + onda * 0.05
            local amplitude = alturaTotal * 0.2
            local deslocamento = onda * 0.5
            
            for x = 1, larguraTotal do
                local y = math.sin(x * frequencia + tempo + deslocamento) * amplitude + alturaTotal / 2
                y = math.floor(y)
                
                if y >= 1 and y <= alturaTotal then
                    desenharNoTelaGigante(x, y, cor)
                    desenharNoTelaGigante(x, y + 1, cor)
                    desenharNoTelaGigante(x, y - 1, cor)
                end
            end
        end
        
        os.sleep(0.1)
    end
end

-- Menu principal
function menu()
    print("\n==========================================")
    print("SHOW TELÃO GIGANTE - 3 TELAS CONECTADAS")
    print("==========================================")
    print("1. Lasers Gigantes")
    print("2. Fogos Melhorados") 
    print("3. Tunel Gigante Aumentado")
    print("4. Matrix Corrigido")
    print("5. Estrelas Cadentes Melhoradas")
    print("6. Equalizador Sincronizado")
    print("7. Ondas Gigantes")
    print("==========================================")
    
    write("Escolha um efeito (1-7): ")
    local escolha = read()
    
    if escolha == "1" then
        efeitoLasersGigantes()
    elseif escolha == "2" then
        efeitoFogosMelhorados()
    elseif escolha == "3" then
        efeitoTunelGigante()
    elseif escolha == "4" then
        efeitoMatrixCorrigido()
    elseif escolha == "5" then
        efeitoEstrelasMelhoradas()
    elseif escolha == "6" then
        efeitoEqualizadorSincronizado()
    elseif escolha == "7" then
        efeitoOndasGigantes()
    else
        print("Opcao invalida! Use 1-7")
        os.sleep(1)
    end
end

-- Programa principal
function main()
    print("Sistema para Telão Gigante Iniciado")
    print("3 telas trabalhando como uma tela de " .. larguraTotal .. "x" .. alturaTotal)
    
    while true do
        menu()
    end
end

-- Inicia o show
main()
