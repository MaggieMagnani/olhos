-- =============================================
-- SISTEMA COM EFEITOS ESTILOSOS
-- =============================================

print("=== SISTEMA COM EFEITOS ESTILOSOS ===")

-- [CONFIGURA√á√ÉO INICIAL E VARI√ÅVEIS MANTIDAS...]
local telas = {peripheral.find("monitor")}
if not telas[1] then telas = {telas} end
print("Telas detectadas: " .. #telas)

for i, tela in ipairs(telas) do
    tela.setTextScale(0.5)
end

-- [MODOS DE COR E VELOCIDADES MANTIDOS...]
local modosCor = {
    ["Branco"] = { cores = {colors.white} },
    ["ColoridoAleatorio"] = {
        cores = { colors.red, colors.orange, colors.yellow, colors.lime, 
                 colors.green, colors.cyan, colors.lightBlue, colors.blue, 
                 colors.purple, colors.pink, colors.magenta }
    },
    ["CorSolida"] = {
        cores = { colors.red, colors.orange, colors.yellow, colors.lime,
                 colors.green, colors.blue, colors.purple, colors.pink }
    }
}

local velocidades = {
    ["Lenta"] = { multiplicador = 2.0 },
    ["Media"] = { multiplicador = 1.0 },
    ["Rapida"] = { multiplicador = 0.5 },
    ["Eletronica"] = { multiplicador = 0.25 }
}

local modoCorAtual = "Branco"
local velocidadeAtual = "Media"
local corSolidaAtual = colors.red

function obterCor(telaIndex)
    if modoCorAtual == "Branco" then return colors.white
    elseif modoCorAtual == "ColoridoAleatorio" then 
        return modosCor.ColoridoAleatorio.cores[math.random(1, #modosCor.ColoridoAleatorio.cores)]
    elseif modoCorAtual == "CorSolida" then return corSolidaAtual end
    return colors.white
end

function aplicarVelocidade(tempoBase)
    return tempoBase * velocidades[velocidadeAtual].multiplicador
end

-- EFEITO 5: CONSTELA√á√ÉO EM MOVIMENTO (que voc√™ amou)
function constelacao()
    print("Constela√ß√£o em Movimento - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local estrelas = {}
    local tempo = 0
    
    for i, tela in ipairs(telas) do
        local w, h = tela.getSize()
        estrelas[i] = {}
        
        for s = 1, 8 do
            estrelas[i][s] = {
                x = math.random(2, w - 1),
                y = math.random(2, h - 1),
                velocidadeX = (math.random() - 0.5) * 0.8,
                velocidadeY = (math.random() - 0.5) * 0.8,
                tamanho = math.random(1, 3),
                cor = obterCor(i)
            }
        end
    end
    
    while true do
        tempo = tempo + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            tela.setBackgroundColor(colors.black)
            tela.clear()
            
            for s, estrela in ipairs(estrelas[i]) do
                estrela.x = estrela.x + estrela.velocidadeX
                estrela.y = estrela.y + estrela.velocidadeY
                
                if estrela.x <= 1 or estrela.x >= w then estrela.velocidadeX = -estrela.velocidadeX end
                if estrela.y <= 1 or estrela.y >= h then estrela.velocidadeY = -estrela.velocidadeY end
                
                estrela.x = math.max(1, math.min(w, estrela.x))
                estrela.y = math.max(1, math.min(h, estrela.y))
                
                local x, y = math.floor(estrela.x), math.floor(estrela.y)
                tela.setBackgroundColor(estrela.cor)
                tela.setCursorPos(x, y)
                tela.write(" ")
                
                if estrela.tamanho >= 2 then
                    if x > 1 then tela.setCursorPos(x - 1, y); tela.write(" ") end
                    if x < w then tela.setCursorPos(x + 1, y); tela.write(" ") end
                end
                if estrela.tamanho >= 3 then
                    if y > 1 then tela.setCursorPos(x, y - 1); tela.write(" ") end
                    if y < h then tela.setCursorPos(x, y + 1); tela.write(" ") end
                end
                
                if math.random(1, 50) == 1 then
                    estrela.cor = obterCor(i)
                end
            end
            
            if tempo % 30 == 0 and #estrelas[i] < 12 then
                table.insert(estrelas[i], {
                    x = math.random(2, w - 1), y = 1,
                    velocidadeX = (math.random() - 0.5) * 0.5,
                    velocidadeY = math.random(0.3, 0.8),
                    tamanho = math.random(1, 3), cor = obterCor(i)
                })
            end
        end
        os.sleep(aplicarVelocidade(0.1))
    end
end

-- EFEITO 6: RASTROS ESTILOSOS (cometas reformulados)
function rastros()
    print("Rastros Estilosos - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local rastros = {}
    local tempo = 0
    
    for i, tela in ipairs(telas) do
        local w, h = tela.getSize()
        rastros[i] = {}
        
        -- Cria rastros verticais
        for r = 1, 3 do
            rastros[i][r] = {
                x = math.random(3, w - 3),
                y = -10, -- Come√ßa acima da tela
                velocidade = math.random(2, 5),
                comprimento = math.random(4, 8),
                cor = obterCor(i),
                espessura = 1
            }
        end
    end
    
    while true do
        tempo = tempo + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            tela.setBackgroundColor(colors.black)
            tela.clear()
            
            -- Atualiza e desenha rastros
            for r = #rastros[i], 1, -1 do
                local rastro = rastros[i][r]
                
                -- Move rastro para baixo
                rastro.y = rastro.y + rastro.velocidade * 0.3
                
                -- Desenha rastro vertical
                for segmento = 0, rastro.comprimento do
                    local yPos = math.floor(rastro.y - segmento)
                    
                    if yPos >= 1 and yPos <= h then
                        -- Intensidade diminui ao longo do rastro
                        local intensidade = 1 - (segmento / rastro.comprimento)
                        
                        if intensidade > 0.3 then
                            tela.setBackgroundColor(rastro.cor)
                            
                            -- Centro do rastro
                            tela.setCursorPos(rastro.x, yPos)
                            tela.write(" ")
                            
                            -- Lados do rastro (mais intenso no centro)
                            if intensidade > 0.6 then
                                tela.setCursorPos(rastro.x - 1, yPos)
                                tela.write(" ")
                                tela.setCursorPos(rastro.x + 1, yPos)
                                tela.write(" ")
                            end
                        end
                    end
                end
                
                -- Remove se saiu da tela
                if rastro.y > h + rastro.comprimento then
                    table.remove(rastros[i], r)
                end
            end
            
            -- Novos rastros
            if math.random(1, 8) == 1 and #rastros[i] < 5 then
                table.insert(rastros[i], {
                    x = math.random(3, w - 3),
                    y = -5,
                    velocidade = math.random(3, 6),
                    comprimento = math.random(5, 10),
                    cor = obterCor(i),
                    espessura = 1
                })
            end
        end
        
        os.sleep(aplicarVelocidade(0.1))
    end
end

-- EFEITO 7: EXPLOS√ïES DE ENERGIA (substitui as linhas)
function explosoes()
    print("Explos√µes de Energia - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local explosoes = {}
    local tempo = 0
    
    for i, tela in ipairs(telas) do
        local w, h = tela.getSize()
        explosoes[i] = {}
    end
    
    while true do
        tempo = tempo + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            tela.setBackgroundColor(colors.black)
            tela.clear()
            
            -- Atualiza explos√µes existentes
            for e = #explosoes[i], 1, -1 do
                local explosao = explosoes[i][e]
                
                explosao.raio = explosao.raio + explosao.velocidade
                explosao.vida = explosao.vida - 1
                
                -- Desenha c√≠rculo de explos√£o
                local centroX, centroY = explosao.x, explosao.y
                local cor = explosao.cor
                
                for angulo = 0, 360, 15 do
                    local x = centroX + math.cos(math.rad(angulo)) * explosao.raio
                    local y = centroY + math.sin(math.rad(angulo)) * explosao.raio
                    
                    x, y = math.floor(x), math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        tela.setBackgroundColor(cor)
                        tela.setCursorPos(x, y)
                        tela.write(" ")
                    end
                end
                
                -- Remove explos√£o se terminou
                if explosao.vida <= 0 or explosao.raio > math.max(w, h) then
                    table.remove(explosoes[i], e)
                end
            end
            
            -- Nova explos√£o aleat√≥ria
            if math.random(1, 20) == 1 then
                local w, h = tela.getSize()
                table.insert(explosoes[i], {
                    x = math.random(5, w - 5),
                    y = math.random(5, h - 5),
                    raio = 1,
                    velocidade = math.random(1, 3) * 0.5,
                    vida = math.random(30, 60),
                    cor = obterCor(i)
                })
            end
        end
        
        os.sleep(aplicarVelocidade(0.08))
    end
end

-- EFEITO 8: ONDAS CONC√äNTRICAS
function ondasConcentricas()
    print("Ondas Conc√™ntricas - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local ondas = {}
    local tempo = 0
    
    for i, tela in ipairs(telas) do
        local w, h = tela.getSize()
        ondas[i] = {}
        
        -- Cria algumas ondas iniciais
        for o = 1, 2 do
            ondas[i][o] = {
                x = math.random(10, w - 10),
                y = math.random(10, h - 10),
                raio = 1,
                velocidade = math.random(2, 4) * 0.3,
                cor = obterCor(i),
                vida = math.random(40, 80)
            }
        end
    end
    
    while true do
        tempo = tempo + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            tela.setBackgroundColor(colors.black)
            tela.clear()
            
            -- Atualiza e desenha ondas
            for o = #ondas[i], 1, -1 do
                local onda = ondas[i][o]
                
                onda.raio = onda.raio + onda.velocidade
                onda.vida = onda.vida - 1
                
                -- Desenha an√©is conc√™ntricos
                for anel = 1, 3 do
                    local raioAnel = onda.raio + (anel - 2) * 2
                    
                    for angulo = 0, 360, 8 do
                        local x = onda.x + math.cos(math.rad(angulo)) * raioAnel
                        local y = onda.y + math.sin(math.rad(angulo)) * raioAnel
                        
                        x, y = math.floor(x), math.floor(y)
                        
                        if x >= 1 and x <= w and y >= 1 and y <= h then
                            tela.setBackgroundColor(onda.cor)
                            tela.setCursorPos(x, y)
                            tela.write(" ")
                        end
                    end
                end
                
                -- Remove onda se terminou
                if onda.vida <= 0 or onda.raio > math.max(w, h) * 0.8 then
                    table.remove(ondas[i], o)
                end
            end
            
            -- Novas ondas
            if tempo % 25 == 0 then
                local w, h = tela.getSize()
                table.insert(ondas[i], {
                    x = math.random(10, w - 10),
                    y = math.random(10, h - 10),
                    raio = 1,
                    velocidade = math.random(2, 4) * 0.3,
                    cor = obterCor(i),
                    vida = math.random(40, 80)
                })
            end
        end
        
        os.sleep(aplicarVelocidade(0.1))
    end
end

-- [MENUS E EFEITOS B√ÅSICOS MANTIDOS...]

function pulsoSequencial()
    print("Pulso Sequencial")
    local telaAtiva = 1
    while true do
        for i, tela in ipairs(telas) do
            tela.setBackgroundColor(colors.black)
            tela.clear()
        end
        local cor = obterCor(telaAtiva)
        telas[telaAtiva].setBackgroundColor(cor)
        telas[telaAtiva].clear()
        telaAtiva = (telaAtiva % #telas) + 1
        os.sleep(aplicarVelocidade(0.3))
    end
end

function onda()
    print("Onda")
    local posicao = 0
    while true do
        posicao = posicao + 1
        for i, tela in ipairs(telas) do
            tela.setBackgroundColor(colors.black)
            tela.clear()
            if (posicao % #telas) + 1 == i then
                tela.setBackgroundColor(obterCor(i))
                tela.clear()
            end
        end
        os.sleep(aplicarVelocidade(0.2))
    end
end

-- MENUS SIMPLIFICADOS
function menuVelocidade()
    print("\nüéµ VELOCIDADE: 1.üê¢ 2.üö∂ 3.üèÉ 4.‚ö°")
    write("Escolha: ") local e = read()
    if e == "1" then velocidadeAtual = "Lenta"
    elseif e == "2" then velocidadeAtual = "Media"
    elseif e == "3" then velocidadeAtual = "Rapida"
    elseif e == "4" then velocidadeAtual = "Eletronica" end
    os.sleep(1)
end

function menuCores()
    print("\nüé® CORES: 1.‚ö™ 2.üåà 3.üé®")
    write("Escolha: ") local e = read()
    if e == "1" then modoCorAtual = "Branco"
    elseif e == "2" then modoCorAtual = "ColoridoAleatorio"
    elseif e == "3" then 
        modoCorAtual = "CorSolida"
        print("üé® 1.üî¥ 2.üü† 3.üü° 4.üü¢ 5.üîµ 6.üü£ 7.üéÄ")
        write("Cor: ") local c = tonumber(read())
        local cores = {colors.red, colors.orange, colors.yellow, colors.green, colors.blue, colors.purple, colors.pink}
        if c and c >=1 and c <=7 then corSolidaAtual = cores[c] end
    end
    os.sleep(1)
end

-- MENU PRINCIPAL
function menuPrincipal()
    menuVelocidade()
    menuCores()
    
    print("\n" .. string.rep("=", 50))
    print("EFEITOS - " .. #telas .. " TELAS")
    print(string.rep("=", 50))
    print("1. Pulso Sequencial")
    print("2. Onda")
    print("3. Respira√ß√£o")
    print("4. Barras Verticais")
    print("5. üåü Constela√ß√£o (FAVORITO)")
    print("6. üí´ Rastros Estilosos (NOVO)")
    print("7. üí• Explos√µes de Energia (NOVO)")
    print("8. üåä Ondas Conc√™ntricas (NOVO)")
    print("9. üîÑ Trocar Config")
    print("0. üö™ Sair")
    print(string.rep("=", 50))
    
    write("Escolha: ") local e = read()
    
    if e == "1" then pulsoSequencial()
    elseif e == "2" then onda()
    elseif e == "5" then constelacao()
    elseif e == "6" then rastros()
    elseif e == "7" then explosoes()
    elseif e == "8" then ondasConcentricas()
    elseif e == "9" then return true
    elseif e == "0" then 
        for i, tela in ipairs(telas) do tela.setBackgroundColor(colors.black); tela.clear() end
        return false
    else print("Inv√°lido!"); os.sleep(1) end
    return true
end

function main()
    print("Sistema Estiloso Iniciado!")
    local executando = true
    while executando do executando = menuPrincipal() end
    print("Fim!")
end

main()
