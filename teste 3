-- EFEITO 9: FITAS LED POR TELA (CORRIGIDO)
function fitasLed()
    print("Fitas LED por Tela - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local posicao = 0
    
    while true do
        posicao = posicao + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            
            -- UMA cor por tela (diferente para cada tela)
            local corTela
            if modoCorAtual == "Branco" then
                corTela = colors.white
            elseif modoCorAtual == "ColoridoAleatorio" then
                -- Cada tela tem uma cor fixa diferente
                local cores = {colors.red, colors.blue, colors.green, colors.yellow, colors.purple, colors.cyan}
                corTela = cores[(i % #cores) + 1]
            else
                corTela = obterCor(i)
            end
            
            -- Preenche a tela inteira com a cor
            tela.setBackgroundColor(corTela)
            tela.clear()
            
            -- Efeito de "scroll" horizontal sutil
            for x = 1, w do
                local intensidade = (math.sin((x + posicao) * 0.2) + 1) / 2
                if intensidade > 0.7 then
                    for y = 1, h do
                        tela.setBackgroundColor(colors.black)
                        tela.setCursorPos(x, y)
                        tela.write(" ")
                    end
                end
            end
        end
        
        os.sleep(aplicarVelocidade(0.15))
    end
end

-- EFEITO 10: PSICODELICO SUAVE (CORRIGIDO - SEM PISCAR)
function psicodelico()
    print("Psicodelico Suave - Modo: " .. modoCorAtual .. " | Velocidade: " .. velocidadeAtual)
    
    local tempo = 0
    
    while true do
        tempo = tempo + 1
        
        for i, tela in ipairs(telas) do
            local w, h = tela.getSize()
            
            -- Fundo psicodelico (sem limpar a tela completamente)
            for x = 1, w do
                for y = 1, h do
                    -- Padrao dinamico suave
                    local r = math.sin(x * 0.1 + tempo * 0.05) * 0.5 + 0.5
                    local g = math.cos(y * 0.1 + tempo * 0.03) * 0.5 + 0.5
                    local b = math.sin((x + y) * 0.05 + tempo * 0.07) * 0.5 + 0.5
                    
                    local intensidade = (r + g + b) / 3
                    
                    if intensidade > 0.6 then
                        local cor
                        if modoCorAtual == "Branco" then
                            cor = colors.white
                        else
                            -- Ciclo de cores baseado na posicao e tempo
                            local corIndex = math.floor((x + y + tempo) * 0.1) % #modosCor.ColoridoAleatorio.cores + 1
                            cor = modosCor.ColoridoAleatorio.cores[corIndex]
                        end
                        
                        tela.setBackgroundColor(cor)
                        tela.setCursorPos(x, y)
                        tela.write(" ")
                    else
                        -- Areas escuras para contraste
                        tela.setBackgroundColor(colors.black)
                        tela.setCursorPos(x, y)
                        tela.write(" ")
                    end
                end
            end
            
            -- Formas geometricas flutuantes (adicionadas sobre o fundo)
            for f = 1, 3 do
                local tamanho = 3 + math.sin(tempo * 0.1 + f) * 2
                local centroX = (math.sin(tempo * 0.02 + f) * 0.5 + 0.5) * w
                local centroY = (math.cos(tempo * 0.015 + f) * 0.5 + 0.5) * h
                
                centroX = math.floor(centroX)
                centroY = math.floor(centroY)
                
                local corForma = obterCor(i)
                
                -- Desenha circulo
                for angulo = 0, 360, 20 do
                    local x = centroX + math.cos(math.rad(angulo)) * tamanho
                    local y = centroY + math.sin(math.rad(angulo)) * tamanho
                    
                    x = math.floor(x)
                    y = math.floor(y)
                    
                    if x >= 1 and x <= w and y >= 1 and y <= h then
                        tela.setBackgroundColor(corForma)
                        tela.setCursorPos(x, y)
                        tela.write(" ")
                    end
                end
            end
        end
        
        os.sleep(aplicarVelocidade(0.1))
    end
end
