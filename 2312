-- =============================================
-- OLHO GIGANTESCO EM TELA ÚNICA GIGANTE
-- Baseado no código do MaggieMagnani
-- =============================================

print("=== INICIANDO OLHO GIGANTESCO ===")

-- Pega TODAS as telas
local telas = {peripheral.find("monitor")}
if not telas[1] then telas = {telas} end

print("Telas detectadas: " .. #telas)

-- Configura todas as telas
for i, tela in ipairs(telas) do
    tela.setTextScale(0.5)
    tela.setBackgroundColor(colors.black)
    tela.clear()
end

-- Sistema da Tela Única Gigante
local larguraGigante, alturaGigante = 0, 0
local tempo = 0

-- Criar a tela única gigante com todas as telas
function criarTelaGigante()
    print("Criando tela gigante com " .. #telas .. " telas...")
    
    local larguraTela, alturaTela = 8, 5  -- Tamanho base com textScale 0.5
    local xAtual, yAtual = 1, 1
    local telasPorLinha = math.min(12, math.ceil(math.sqrt(#telas) * 2))
    
    -- Organizar todas as telas em uma grade contínua
    for i, tela in ipairs(telas) do
        tela.posXGlobal = xAtual
        tela.posYGlobal = yAtual
        tela.largura = larguraTela
        tela.altura = alturaTela
        
        -- Atualizar dimensões da tela gigante
        larguraGigante = math.max(larguraGigante, xAtual + larguraTela - 1)
        alturaGigante = math.max(alturaGigante, yAtual + alturaTela - 1)
        
        -- Próxima posição
        xAtual = xAtual + larguraTela
        
        -- Quebra de linha
        if i % telasPorLinha == 0 then
            xAtual = 1
            yAtual = yAtual + alturaTela
        end
    end
    
    print("TELA GIGANTE CRIADA: " .. larguraGigante .. "x" .. alturaGigante)
end

-- Limpar TODAS as telas
function limparTodasTelas()
    for i, tela in ipairs(telas) do
        tela.setBackgroundColor(colors.black)
        tela.clear()
    end
end

-- Desenhar na tela gigante (coordendas globais)
function desenharNaTelaGigante(xGlobal, yGlobal, cor)
    for i, tela in ipairs(telas) do
        -- Verificar se estas coordenadas globais estão nesta tela
        if xGlobal >= tela.posXGlobal and xGlobal < tela.posXGlobal + tela.largura and
           yGlobal >= tela.posYGlobal and yGlobal < tela.posYGlobal + tela.altura then
            
            -- Converter para coordenadas locais da tela
            local xLocal = xGlobal - tela.posXGlobal + 1
            local yLocal = yGlobal - tela.posYGlobal + 1
            
            -- Desenhar
            tela.setBackgroundColor(cor)
            tela.setCursorPos(xLocal, yLocal)
            tela.write(" ")
            return true
        end
    end
    return false
end

-- OLHO GIGANTESCO baseado no seu código
function desenharOlhoGigante(xCentro, yCentro)
    -- Tamanho GIGANTE do olho (baseado no seu código mas ampliado)
    local raioExterno = 8      -- Olho enorme!
    local raioIris = 5         -- Íris grande
    local raioPupila = 3       -- Pupila grande
    local raioBrilho = 2       -- Brilho grande
    
    -- Desenhar olho completo
    for x = -raioExterno, raioExterno do
        for y = -raioExterno, raioExterno do
            local distancia = math.sqrt(x*x + y*y)
            
            -- Branco do olho (parte externa)
            if distancia <= raioExterno then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.white)
            end
            
            -- Íris azul
            if distancia <= raioIris then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.blue)
            end
            
            -- Pupila preta
            if distancia <= raioPupila then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.black)
            end
            
            -- Brilhos (baseado no seu código)
            local brilho1X, brilho1Y = -2, -2
            local brilho2X, brilho2Y = 1, -3
            
            if x == brilho1X and y == brilho1Y then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.lightBlue)
            end
            
            if x == brilho2X and y == brilho2Y then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.white)
            end
        end
    end
    
    -- Contorno preto para definição (melhoria visual)
    for x = -raioExterno-1, raioExterno+1 do
        for y = -raioExterno-1, raioExterno+1 do
            local distancia = math.sqrt(x*x + y*y)
            if distancia > raioExterno and distancia <= raioExterno + 1 then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.black)
            end
        end
    end
end

-- OLHO GIGANTESCO ALTERNATivo (outro estilo)
function desenharOlhoGigante2(xCentro, yCentro)
    -- Olho ainda MAIOR!
    local raioExterno = 10
    local raioIris = 7
    local raioPupila = 4
    local raioBrilho = 3
    
    -- Forma mais ovalada (como olho real)
    for x = -raioExterno, raioExterno do
        for y = -math.floor(raioExterno * 0.7), math.floor(raioExterno * 0.7) do
            local elipse = (x*x)/(raioExterno*raioExterno) + (y*y)/((raioExterno*0.7)*(raioExterno*0.7))
            
            -- Branco do olho
            if elipse <= 1 then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.white)
            end
            
            -- Íris
            local elipseIris = (x*x)/(raioIris*raioIris) + (y*y)/((raioIris*0.7)*(raioIris*0.7))
            if elipseIris <= 1 then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.blue)
            end
            
            -- Pupila
            local elipsePupila = (x*x)/(raioPupila*raioPupila) + (y*y)/((raioPupila*0.7)*(raioPupila*0.7))
            if elipsePupila <= 1 then
                desenharNaTelaGigante(xCentro + x, yCentro + y, colors.black)
            end
        end
    end
    
    -- Brilhos grandes
    desenharNaTelaGigante(xCentro - 3, yCentro - 2, colors.lightBlue)
    desenharNaTelaGigante(xCentro - 2, yCentro - 3, colors.lightBlue)
    desenharNaTelaGigante(xCentro + 2, yCentro - 2, colors.white)
    desenharNaTelaGigante(xCentro + 1, yCentro - 3, colors.white)
end

-- Movimentos pela tela gigante
function movimentoCircularGigante(t)
    local centroX = larguraGigante / 2
    local centroY = alturaGigante / 2
    
    -- Movimento circular amplo
    local raio = math.min(centroX, centroY) - 12
    local x = centroX + math.cos(t * 0.4) * raio
    local y = centroY + math.sin(t * 0.6) * (raio * 0.8)
    
    return math.floor(x), math.floor(y)
end

function movimentoVarreduraCompleta(t)
    -- Varredura por toda a tela gigante
    local velocidade = 0.08
    local periodo = 60  -- segundos para varrer toda a tela
    
    local progresso = (t * velocidade) % 4
    local x, y
    
    if progresso < 1 then
        -- Topo → Direita
        x = 1 + (larguraGigante - 1) * progresso
        y = 1
    elseif progresso < 2 then
        -- Direita → Fundo
        x = larguraGigante
        y = 1 + (alturaGigante - 1) * (progresso - 1)
    elseif progresso < 3 then
        -- Fundo → Esquerda
        x = larguraGigante - (larguraGigante - 1) * (progresso - 2)
        y = alturaGigante
    else
        -- Esquerda → Topo
        x = 1
        y = alturaGigante - (alturaGigante - 1) * (progresso - 3)
    end
    
    return math.floor(x), math.floor(y)
end

function movimentoOndulatorioGigante(t)
    -- Onda por toda a tela gigante
    local x = (math.sin(t * 0.03) * 0.5 + 0.5) * (larguraGigante - 20) + 10
    local y = (math.cos(t * 0.05) * 0.5 + 0.5) * (alturaGigante - 15) + 8
    
    return math.floor(x), math.floor(y)
end

function movimentoEspiralGigante(t)
    local centroX = larguraGigante / 2
    local centroY = alturaGigante / 2
    
    -- Espiral que cresce e diminui
    local raioBase = 5
    local raioVar = 10
    local raio = raioBase + math.sin(t * 0.2) * raioVar
    
    local x = centroX + math.cos(t * 0.5) * raio
    local y = centroY + math.sin(t * 0.7) * (raio * 0.6)
    
    return math.floor(x), math.floor(y)
end

-- Animação principal
function executarAnimacao()
    local modosMovimento = {
        movimentoCircularGigante,
        movimentoVarreduraCompleta,
        movimentoOndulatorioGigante,
        movimentoEspiralGigante
    }
    
    local nomesModos = {
        "Circular pela Tela Gigante",
        "Varredura Completa das Bordas",
        "Ondas pela Área Total",
        "Espiral Expansiva"
    }
    
    local modoAtual = 1
    local ultimaTroca = os.time()
    
    print("\n=== OLHO GIGANTESCO ATIVADO ===")
    print("Telas: " .. #telas .. " - Área: " .. larguraGigante .. "x" .. alturaGigante)
    print("Tamanho do Olho: ~16x16 pixels (ENORME)")
    print("Modo: " .. nomesModos[modoAtual])
    print("Pressione Ctrl+T para parar")
    print("===============================\n")
    
    while true do
        -- Trocar modo a cada 45 segundos
        if os.time() - ultimaTroca > 45 then
            modoAtual = (modoAtual % #modosMovimento) + 1
            ultimaTroca = os.time()
            print("Mudando para: " .. nomesModos[modoAtual])
        end
        
        -- Calcular posição na tela gigante
        local x, y = modosMovimento[modoAtual](tempo)
        
        -- Garantir que o olho gigante caiba na tela
        x = math.max(12, math.min(larguraGigante - 11, x))
        y = math.max(10, math.min(alturaGigante - 9, y))
        
        -- Limpar e desenhar
        limparTodasTelas()
        
        -- Alternar entre os dois estilos de olho gigante
        if math.sin(tempo * 1.2) > 0 then
            desenharOlhoGigante(x, y)
        else
            desenharOlhoGigante2(x, y)
        end
        
        tempo = tempo + 0.1
        os.sleep(0.15)
    end
end

-- Programa principal
if #telas == 0 then
    print("ERRO: Nenhuma tela detectada!")
else
    criarTelaGigante()
    executarAnimacao()
end
